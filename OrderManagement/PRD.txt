except: false
---

Please implement DDD-based microservice architecture code for an event storming model-based domain using Spring Boot 3 and DDD Extension. The code must be implemented strictly based on the metadata provided below and @generation-rules:

OrderManagement Metadata:
{"_type":"BoundedContext","aggregates":[{"_type":"Aggregate","aggregateRoot":{"_type":"AggregateRoot","fieldDescriptors":[{"_type":"FieldDescriptor","className":"Long","displayName":"","name":"cartItemId"},{"_type":"FieldDescriptor","className":"Long","displayName":"","name":"userId"},{"_type":"FieldDescriptor","className":"String","displayName":"","name":"size"},{"_type":"FieldDescriptor","className":"String","displayName":"","name":"width"},{"_type":"FieldDescriptor","className":"Boolean","displayName":"","name":"isFlatFooted"},{"_type":"FieldDescriptor","className":"Integer","displayName":"","name":"quantity"},{"_type":"FieldDescriptor","className":"CartItemStatus","displayName":"","name":"status"},{"_type":"FieldDescriptor","className":"Date","displayName":"","name":"createdAt"},{"_type":"FieldDescriptor","className":"Date","displayName":"","name":"updatedAt"},{"_type":"FieldDescriptor","name":"productId","className":"ProductId","displayName":"상품 ID"},{"_type":"FieldDescriptor","name":"inventoryStockId","className":"InventoryStockId","displayName":"옵션별재고 ID"}]},"commands":[{"_type":"Command","controllerInfo":{"apiPath":"selectproductoption","fullApiPath":"","method":"POST"},"displayName":"상품 옵션 선택","fieldDescriptors":[{"_type":"FieldDescriptor","className":"Long","displayName":"","name":"userId"},{"_type":"FieldDescriptor","className":"ProductId","displayName":"","name":"productId"},{"_type":"FieldDescriptor","className":"String","displayName":"","name":"size"},{"_type":"FieldDescriptor","className":"String","displayName":"","name":"width"},{"_type":"FieldDescriptor","className":"Boolean","displayName":"","name":"isFlatFooted"}],"isRestRepository":false,"name":"SelectProductOption","restRepositoryInfo":{"method":"POST"},"trigger":"@PrePersist","examples":[{"given":[{"name":"CartItem","type":"Aggregate","value":{"cartItemId":1001,"createdAt":"2024-06-01T10:00:00Z","inventoryStockId":{"inventoryStockId":4001},"isFlatFooted":false,"productId":{"productId":3001},"quantity":1,"size":"260","status":"IN_CART","updatedAt":"2024-06-01T10:00:00Z","userId":2001,"width":"D"}}],"then":[{"name":"ProductOptionSelected","type":"Event","value":{"isFlatFooted":true,"optionSelectedAt":"2024-06-01T10:05:00Z","productId":{"productId":3001},"size":"265","userId":2001,"width":"E"}}],"when":[{"name":"SelectProductOption","type":"Command","value":{"isFlatFooted":true,"productId":{"productId":3001},"size":"265","userId":2001,"width":"E"}}]},{"given":[{"name":"CartItem","type":"Aggregate","value":{"cartItemId":1002,"createdAt":"2024-06-01T10:00:00Z","inventoryStockId":{"inventoryStockId":4002},"isFlatFooted":false,"productId":{"productId":3002},"quantity":1,"status":"IN_CART","updatedAt":"2024-06-01T10:00:00Z","userId":2002,"width":"D"}}],"then":[{"name":"OrderPlacementFailedDueToMissingOption","type":"Event","value":{"cartItemIds":[{"cartItemId":1002}],"errorMessage":"필수 옵션(사이즈)이 선택되지 않았습니다.","userId":2002}}],"when":[{"name":"SelectProductOption","type":"Command","value":{"isFlatFooted":false,"productId":{"productId":3002},"userId":2002,"width":"D"}}]}],"type":"Command"},{"_type":"Command","controllerInfo":{"apiPath":"addcartitem","fullApiPath":"","method":"POST"},"displayName":"장바구니에 상품 추가","fieldDescriptors":[{"_type":"FieldDescriptor","className":"Long","displayName":"","name":"userId"},{"_type":"FieldDescriptor","className":"ProductId","displayName":"","name":"productId"},{"_type":"FieldDescriptor","className":"String","displayName":"","name":"size"},{"_type":"FieldDescriptor","className":"String","displayName":"","name":"width"},{"_type":"FieldDescriptor","className":"Boolean","displayName":"","name":"isFlatFooted"},{"_type":"FieldDescriptor","className":"Integer","displayName":"","name":"quantity"},{"_type":"FieldDescriptor","className":"InventoryStockId","displayName":"","name":"inventoryStockId"}],"isRestRepository":false,"name":"AddCartItem","restRepositoryInfo":{"method":"POST"},"trigger":"@PrePersist","examples":[{"given":[{"name":"CartItem","type":"Aggregate","value":{"cartItemId":1003,"createdAt":"2024-06-01T10:00:00Z","inventoryStockId":{"inventoryStockId":4003},"isFlatFooted":false,"productId":{"productId":3003},"quantity":0,"size":"255","status":"IN_CART","updatedAt":"2024-06-01T10:00:00Z","userId":2003,"width":"E"}}],"then":[{"name":"CartItemAdded","type":"Event","value":{"addedAt":"2024-06-01T10:10:00Z","cartItemId":1003,"inventoryStockId":{"inventoryStockId":4003},"isFlatFooted":false,"productId":{"productId":3003},"quantity":2,"size":"255","userId":2003,"width":"E"}}],"when":[{"name":"AddCartItem","type":"Command","value":{"inventoryStockId":{"inventoryStockId":4003},"isFlatFooted":false,"productId":{"productId":3003},"quantity":2,"size":"255","userId":2003,"width":"E"}}]},{"given":[{"name":"CartItem","type":"Aggregate","value":{"cartItemId":1004,"createdAt":"2024-06-01T10:00:00Z","inventoryStockId":{"inventoryStockId":4004},"isFlatFooted":true,"productId":{"productId":3004},"quantity":0,"size":"250","status":"IN_CART","updatedAt":"2024-06-01T10:00:00Z","userId":2004,"width":"D"}}],"then":[{"name":"OrderPlacementFailedDueToMissingOption","type":"Event","value":{"cartItemIds":[{"cartItemId":1004}],"errorMessage":"수량이 1개 이상이어야 합니다.","userId":2004}}],"when":[{"name":"AddCartItem","type":"Command","value":{"inventoryStockId":{"inventoryStockId":4004},"isFlatFooted":true,"productId":{"productId":3004},"quantity":0,"size":"250","userId":2004,"width":"D"}}]}],"type":"Command"}],"displayName":"장바구니항목","events":[{"_type":"Event","displayName":"장바구니에 상품이 추가됨","fieldDescriptors":[{"_type":"FieldDescriptor","className":"Long","displayName":"","name":"cartItemId"},{"_type":"FieldDescriptor","className":"Long","displayName":"","name":"userId"},{"_type":"FieldDescriptor","className":"ProductId","displayName":"","name":"productId"},{"_type":"FieldDescriptor","className":"String","displayName":"","name":"size"},{"_type":"FieldDescriptor","className":"String","displayName":"","name":"width"},{"_type":"FieldDescriptor","className":"Boolean","displayName":"","name":"isFlatFooted"},{"_type":"FieldDescriptor","className":"Integer","displayName":"","name":"quantity"},{"_type":"FieldDescriptor","className":"InventoryStockId","displayName":"","name":"inventoryStockId"},{"_type":"FieldDescriptor","className":"Date","displayName":"","name":"addedAt"}],"name":"CartItemAdded","trigger":"","type":"Event"},{"_type":"Event","displayName":"상품 옵션이 선택됨","fieldDescriptors":[{"_type":"FieldDescriptor","className":"Long","displayName":"","name":"userId"},{"_type":"FieldDescriptor","className":"ProductId","displayName":"","name":"productId"},{"_type":"FieldDescriptor","className":"String","displayName":"","name":"size"},{"_type":"FieldDescriptor","className":"String","displayName":"","name":"width"},{"_type":"FieldDescriptor","className":"Boolean","displayName":"","name":"isFlatFooted"},{"_type":"FieldDescriptor","className":"Date","displayName":"","name":"optionSelectedAt"}],"name":"ProductOptionSelected","trigger":"","type":"Event"}],"name":"CartItem","type":"Aggregate","lifeCycles":[{"trigger":"PrePersist","commands":[{"_type":"Command","controllerInfo":{"apiPath":"selectproductoption","fullApiPath":"","method":"POST"},"displayName":"상품 옵션 선택","fieldDescriptors":[{"_type":"FieldDescriptor","className":"Long","displayName":"","name":"userId"},{"_type":"FieldDescriptor","className":"ProductId","displayName":"","name":"productId"},{"_type":"FieldDescriptor","className":"String","displayName":"","name":"size"},{"_type":"FieldDescriptor","className":"String","displayName":"","name":"width"},{"_type":"FieldDescriptor","className":"Boolean","displayName":"","name":"isFlatFooted"}],"isRestRepository":false,"name":"SelectProductOption","restRepositoryInfo":{"method":"POST"},"trigger":"@PrePersist","examples":[{"given":[{"name":"CartItem","type":"Aggregate","value":{"cartItemId":1001,"createdAt":"2024-06-01T10:00:00Z","inventoryStockId":{"inventoryStockId":4001},"isFlatFooted":false,"productId":{"productId":3001},"quantity":1,"size":"260","status":"IN_CART","updatedAt":"2024-06-01T10:00:00Z","userId":2001,"width":"D"}}],"then":[{"name":"ProductOptionSelected","type":"Event","value":{"isFlatFooted":true,"optionSelectedAt":"2024-06-01T10:05:00Z","productId":{"productId":3001},"size":"265","userId":2001,"width":"E"}}],"when":[{"name":"SelectProductOption","type":"Command","value":{"isFlatFooted":true,"productId":{"productId":3001},"size":"265","userId":2001,"width":"E"}}]},{"given":[{"name":"CartItem","type":"Aggregate","value":{"cartItemId":1002,"createdAt":"2024-06-01T10:00:00Z","inventoryStockId":{"inventoryStockId":4002},"isFlatFooted":false,"productId":{"productId":3002},"quantity":1,"status":"IN_CART","updatedAt":"2024-06-01T10:00:00Z","userId":2002,"width":"D"}}],"then":[{"name":"OrderPlacementFailedDueToMissingOption","type":"Event","value":{"cartItemIds":[{"cartItemId":1002}],"errorMessage":"필수 옵션(사이즈)이 선택되지 않았습니다.","userId":2002}}],"when":[{"name":"SelectProductOption","type":"Command","value":{"isFlatFooted":false,"productId":{"productId":3002},"userId":2002,"width":"D"}}]}],"type":"Command"},{"_type":"Command","controllerInfo":{"apiPath":"addcartitem","fullApiPath":"","method":"POST"},"displayName":"장바구니에 상품 추가","fieldDescriptors":[{"_type":"FieldDescriptor","className":"Long","displayName":"","name":"userId"},{"_type":"FieldDescriptor","className":"ProductId","displayName":"","name":"productId"},{"_type":"FieldDescriptor","className":"String","displayName":"","name":"size"},{"_type":"FieldDescriptor","className":"String","displayName":"","name":"width"},{"_type":"FieldDescriptor","className":"Boolean","displayName":"","name":"isFlatFooted"},{"_type":"FieldDescriptor","className":"Integer","displayName":"","name":"quantity"},{"_type":"FieldDescriptor","className":"InventoryStockId","displayName":"","name":"inventoryStockId"}],"isRestRepository":false,"name":"AddCartItem","restRepositoryInfo":{"method":"POST"},"trigger":"@PrePersist","examples":[{"given":[{"name":"CartItem","type":"Aggregate","value":{"cartItemId":1003,"createdAt":"2024-06-01T10:00:00Z","inventoryStockId":{"inventoryStockId":4003},"isFlatFooted":false,"productId":{"productId":3003},"quantity":0,"size":"255","status":"IN_CART","updatedAt":"2024-06-01T10:00:00Z","userId":2003,"width":"E"}}],"then":[{"name":"CartItemAdded","type":"Event","value":{"addedAt":"2024-06-01T10:10:00Z","cartItemId":1003,"inventoryStockId":{"inventoryStockId":4003},"isFlatFooted":false,"productId":{"productId":3003},"quantity":2,"size":"255","userId":2003,"width":"E"}}],"when":[{"name":"AddCartItem","type":"Command","value":{"inventoryStockId":{"inventoryStockId":4003},"isFlatFooted":false,"productId":{"productId":3003},"quantity":2,"size":"255","userId":2003,"width":"E"}}]},{"given":[{"name":"CartItem","type":"Aggregate","value":{"cartItemId":1004,"createdAt":"2024-06-01T10:00:00Z","inventoryStockId":{"inventoryStockId":4004},"isFlatFooted":true,"productId":{"productId":3004},"quantity":0,"size":"250","status":"IN_CART","updatedAt":"2024-06-01T10:00:00Z","userId":2004,"width":"D"}}],"then":[{"name":"OrderPlacementFailedDueToMissingOption","type":"Event","value":{"cartItemIds":[{"cartItemId":1004}],"errorMessage":"수량이 1개 이상이어야 합니다.","userId":2004}}],"when":[{"name":"AddCartItem","type":"Command","value":{"inventoryStockId":{"inventoryStockId":4004},"isFlatFooted":true,"productId":{"productId":3004},"quantity":0,"size":"250","userId":2004,"width":"D"}}]}],"type":"Command"}]}]},{"_type":"Aggregate","aggregateRoot":{"_type":"AggregateRoot","entities":{"relations":[{"_type":"Relation","name":"OrderStatus","targetElement":{"_type":"enum","displayName":"주문상태","name":"OrderStatus"}}]},"fieldDescriptors":[{"_type":"FieldDescriptor","className":"Long","displayName":"","name":"orderId"},{"_type":"FieldDescriptor","className":"Long","displayName":"","name":"userId"},{"_type":"FieldDescriptor","className":"List<OrderItem>","displayName":"","name":"items"},{"_type":"FieldDescriptor","className":"OrderStatus","displayName":"","name":"status"},{"_type":"FieldDescriptor","className":"OrderPaymentStatus","displayName":"","name":"paymentStatus"},{"_type":"FieldDescriptor","className":"List<OrderHistory>","displayName":"","name":"orderHistory"},{"_type":"FieldDescriptor","className":"Date","displayName":"","name":"createdAt"},{"_type":"FieldDescriptor","className":"Date","displayName":"","name":"updatedAt"},{"_type":"FieldDescriptor","name":"cartItemId","className":"CartItemId","displayName":"장바구니항목 ID"}]},"commands":[{"_type":"Command","controllerInfo":{"apiPath":"requestorderpayment","fullApiPath":"","method":"POST"},"displayName":"주문 결제 요청","fieldDescriptors":[{"_type":"FieldDescriptor","className":"Long","displayName":"","name":"orderId"}],"isRestRepository":false,"name":"RequestOrderPayment","restRepositoryInfo":{"method":"POST"},"trigger":"@PrePersist","examples":[{"given":[{"name":"Order","type":"Aggregate","value":{"cartItemId":"N/A","createdAt":"2024-06-01T10:01:00Z","items":[{"isFlatFooted":false,"price":99000,"productId":4001,"quantity":1,"size":"260","width":"D"}],"orderId":1002,"paymentStatus":"NOT_REQUESTED","status":"PLACED","updatedAt":"2024-06-01T10:01:00Z","userId":2001}}],"then":[{"name":"OrderPaymentRequested","type":"Event","value":{"items":[{"isFlatFooted":false,"price":99000,"productId":4001,"quantity":1,"size":"260","width":"D"}],"orderId":1002,"paymentStatus":"REQUESTED","totalAmount":99000,"userId":2001}}],"when":[{"name":"RequestOrderPayment","type":"Command","value":{"orderId":1002}}]}],"type":"Command"},{"_type":"Command","controllerInfo":{"apiPath":"placeorder","fullApiPath":"","method":"POST"},"displayName":"주문 생성","fieldDescriptors":[{"_type":"FieldDescriptor","className":"Long","displayName":"","name":"userId"},{"_type":"FieldDescriptor","className":"List<CartItemId>","displayName":"","name":"cartItemIds"}],"isRestRepository":false,"name":"PlaceOrder","restRepositoryInfo":{"method":"POST"},"trigger":"@PrePersist","examples":[{"given":[{"name":"Order","type":"Aggregate","value":{"cartItemId":"N/A","createdAt":"2024-06-01T10:00:00Z","orderId":1001,"paymentStatus":"NOT_REQUESTED","status":"PLACED","updatedAt":"2024-06-01T10:00:00Z","userId":2001}}],"then":[{"name":"OrderPlaced","type":"Event","value":{"createdAt":"2024-06-01T10:01:00Z","items":[{"isFlatFooted":false,"price":99000,"productId":4001,"quantity":1,"size":"260","width":"D"}],"orderId":1002,"status":"PLACED","userId":2001}}],"when":[{"name":"PlaceOrder","type":"Command","value":{"cartItemIds":[{"cartItemId":3001}],"userId":2001}}]},{"given":[{"name":"Order","type":"Aggregate","value":{"cartItemId":"N/A","createdAt":"2024-06-01T10:00:00Z","orderId":1003,"paymentStatus":"NOT_REQUESTED","status":"PLACED","updatedAt":"2024-06-01T10:00:00Z","userId":2002}}],"then":[{"name":"OrderPlacementFailedDueToMissingOption","type":"Event","value":{"cartItemIds":[{"cartItemId":3002}],"errorMessage":"필수 옵션(사이즈 등)이 선택되지 않았습니다.","userId":2002}}],"when":[{"name":"PlaceOrder","type":"Command","value":{"cartItemIds":[{"cartItemId":3002}],"userId":2002}}]}],"type":"Command"},{"_type":"Command","controllerInfo":{"apiPath":"updateorderhistory","fullApiPath":"","method":"POST"},"displayName":"주문 이력 갱신","fieldDescriptors":[{"_type":"FieldDescriptor","className":"Long","displayName":"","name":"orderId"},{"_type":"FieldDescriptor","className":"OrderStatus","displayName":"","name":"status"}],"isRestRepository":false,"name":"UpdateOrderHistory","restRepositoryInfo":{"method":"POST"},"trigger":"@PrePersist","examples":[{"given":[{"name":"Order","type":"Aggregate","value":{"cartItemId":"N/A","createdAt":"2024-06-01T10:01:00Z","items":[{"isFlatFooted":false,"price":99000,"productId":4001,"quantity":1,"size":"260","width":"D"}],"orderHistory":[{"changedAt":"2024-06-01T10:04:00Z","status":"PAID"}],"orderId":1002,"paymentStatus":"COMPLETED","status":"DELIVERED","updatedAt":"2024-06-01T10:06:00Z","userId":2001}}],"then":[{"name":"OrderHistoryUpdated","type":"Event","value":{"orderId":1002,"status":"DELIVERED","updatedAt":"2024-06-01T10:07:00Z"}}],"when":[{"name":"UpdateOrderHistory","type":"Command","value":{"orderId":1002,"status":"DELIVERED"}}]}],"type":"Command"},{"_type":"Command","controllerInfo":{"apiPath":"displayorderhistory","fullApiPath":"","method":"POST"},"displayName":"주문 이력 노출","fieldDescriptors":[{"_type":"FieldDescriptor","className":"Long","displayName":"","name":"orderId"}],"isRestRepository":false,"name":"DisplayOrderHistory","restRepositoryInfo":{"method":"POST"},"trigger":"@PrePersist","examples":[{"given":[{"name":"Order","type":"Aggregate","value":{"cartItemId":"N/A","createdAt":"2024-06-01T10:01:00Z","items":[{"isFlatFooted":false,"price":99000,"productId":4001,"quantity":1,"size":"260","width":"D"}],"orderHistory":[{"changedAt":"2024-06-01T10:04:00Z","status":"PAID"},{"changedAt":"2024-06-01T10:06:00Z","status":"DELIVERED"}],"orderId":1002,"paymentStatus":"COMPLETED","status":"DELIVERED","updatedAt":"2024-06-01T10:07:00Z","userId":2001}}],"then":[{"name":"OrderHistoryDisplayed","type":"Event","value":{"displayedAt":"2024-06-01T10:08:00Z","items":[{"isFlatFooted":false,"price":99000,"productId":4001,"quantity":1,"size":"260","width":"D"}],"orderId":1002,"status":"DELIVERED","userId":2001}}],"when":[{"name":"DisplayOrderHistory","type":"Command","value":{"orderId":1002}}]}],"type":"Command"},{"_type":"Command","controllerInfo":{"apiPath":"rollbackorder","fullApiPath":"","method":"POST"},"displayName":"주문 롤백","fieldDescriptors":[{"_type":"FieldDescriptor","className":"Long","displayName":"","name":"orderId"},{"_type":"FieldDescriptor","className":"String","displayName":"","name":"rollbackReason"}],"isRestRepository":false,"name":"RollbackOrder","restRepositoryInfo":{"method":"POST"},"trigger":"@PrePersist","examples":[{"given":[{"name":"Order","type":"Aggregate","value":{"cartItemId":"N/A","createdAt":"2024-06-01T10:01:00Z","items":[{"isFlatFooted":false,"price":99000,"productId":4001,"quantity":1,"size":"260","width":"D"}],"orderId":1002,"paymentStatus":"FAILED","status":"PAYMENT_FAILED","updatedAt":"2024-06-01T10:02:00Z","userId":2001}}],"then":[{"name":"OrderRolledBack","type":"Event","value":{"orderId":1002,"rollbackReason":"결제 실패로 인한 롤백","rolledBackAt":"2024-06-01T10:03:00Z"}}],"when":[{"name":"RollbackOrder","type":"Command","value":{"orderId":1002,"rollbackReason":"결제 실패로 인한 롤백"}}]}],"type":"Command"},{"_type":"Command","controllerInfo":{"apiPath":"readyorderforshipment","fullApiPath":"","method":"POST"},"displayName":"주문 출고 준비","fieldDescriptors":[{"_type":"FieldDescriptor","className":"Long","displayName":"","name":"orderId"}],"isRestRepository":false,"name":"ReadyOrderForShipment","restRepositoryInfo":{"method":"POST"},"trigger":"@PrePersist","examples":[{"given":[{"name":"Order","type":"Aggregate","value":{"cartItemId":"N/A","createdAt":"2024-06-01T10:01:00Z","items":[{"isFlatFooted":false,"price":99000,"productId":4001,"quantity":1,"size":"260","width":"D"}],"orderId":1002,"paymentStatus":"COMPLETED","status":"PAID","updatedAt":"2024-06-01T10:04:00Z","userId":2001}}],"then":[{"name":"OrderReadyForShipment","type":"Event","value":{"items":[{"isFlatFooted":false,"price":99000,"productId":4001,"quantity":1,"size":"260","width":"D"}],"orderId":1002,"readyForShipmentAt":"2024-06-01T10:05:00Z"}}],"when":[{"name":"ReadyOrderForShipment","type":"Command","value":{"orderId":1002}}]}],"type":"Command"}],"displayName":"주문","events":[{"_type":"Event","displayName":"주문 내역이 업데이트됨","fieldDescriptors":[{"_type":"FieldDescriptor","className":"Long","displayName":"","name":"orderId"},{"_type":"FieldDescriptor","className":"OrderStatus","displayName":"","name":"status"},{"_type":"FieldDescriptor","className":"Date","displayName":"","name":"updatedAt"}],"name":"OrderHistoryUpdated","trigger":"","type":"Event"},{"_type":"Event","displayName":"주문이 생성됨","fieldDescriptors":[{"_type":"FieldDescriptor","className":"Long","displayName":"","name":"orderId"},{"_type":"FieldDescriptor","className":"Long","displayName":"","name":"userId"},{"_type":"FieldDescriptor","className":"List<OrderItem>","displayName":"","name":"items"},{"_type":"FieldDescriptor","className":"OrderStatus","displayName":"","name":"status"},{"_type":"FieldDescriptor","className":"Date","displayName":"","name":"createdAt"}],"name":"OrderPlaced","trigger":"","type":"Event"},{"_type":"Event","displayName":"필수 옵션 미선택으로 주문이 실패됨","fieldDescriptors":[{"_type":"FieldDescriptor","className":"Long","displayName":"","name":"userId"},{"_type":"FieldDescriptor","className":"List<CartItemId>","displayName":"","name":"cartItemIds"},{"_type":"FieldDescriptor","className":"String","displayName":"","name":"errorMessage"}],"name":"OrderPlacementFailedDueToMissingOption","trigger":"","type":"Event"},{"_type":"Event","displayName":"결제가 요청됨","fieldDescriptors":[{"_type":"FieldDescriptor","className":"Long","displayName":"","name":"orderId"},{"_type":"FieldDescriptor","className":"Long","displayName":"","name":"userId"},{"_type":"FieldDescriptor","className":"List<OrderItem>","displayName":"","name":"items"},{"_type":"FieldDescriptor","className":"Double","displayName":"","name":"totalAmount"},{"_type":"FieldDescriptor","className":"OrderPaymentStatus","displayName":"","name":"paymentStatus"}],"name":"OrderPaymentRequested","trigger":"","type":"Event"},{"_type":"Event","displayName":"주문 내역이 사용자 및 CS에 노출됨","fieldDescriptors":[{"_type":"FieldDescriptor","className":"Long","displayName":"","name":"orderId"},{"_type":"FieldDescriptor","className":"Long","displayName":"","name":"userId"},{"_type":"FieldDescriptor","className":"List<OrderItem>","displayName":"","name":"items"},{"_type":"FieldDescriptor","className":"OrderStatus","displayName":"","name":"status"},{"_type":"FieldDescriptor","className":"Date","displayName":"","name":"displayedAt"}],"name":"OrderHistoryDisplayed","trigger":"","type":"Event"},{"_type":"Event","displayName":"주문이 출고 준비됨","fieldDescriptors":[{"_type":"FieldDescriptor","className":"Long","displayName":"","name":"orderId"},{"_type":"FieldDescriptor","className":"List<OrderItem>","displayName":"","name":"items"},{"_type":"FieldDescriptor","className":"Date","displayName":"","name":"readyForShipmentAt"}],"name":"OrderReadyForShipment","trigger":"","type":"Event"},{"_type":"Event","displayName":"주문이 롤백됨","fieldDescriptors":[{"_type":"FieldDescriptor","className":"Long","displayName":"","name":"orderId"},{"_type":"FieldDescriptor","className":"String","displayName":"","name":"rollbackReason"},{"_type":"FieldDescriptor","className":"Date","displayName":"","name":"rolledBackAt"}],"name":"OrderRolledBack","trigger":"","type":"Event"}],"name":"Order","type":"Aggregate","lifeCycles":[{"trigger":"PrePersist","commands":[{"_type":"Command","controllerInfo":{"apiPath":"requestorderpayment","fullApiPath":"","method":"POST"},"displayName":"주문 결제 요청","fieldDescriptors":[{"_type":"FieldDescriptor","className":"Long","displayName":"","name":"orderId"}],"isRestRepository":false,"name":"RequestOrderPayment","restRepositoryInfo":{"method":"POST"},"trigger":"@PrePersist","examples":[{"given":[{"name":"Order","type":"Aggregate","value":{"cartItemId":"N/A","createdAt":"2024-06-01T10:01:00Z","items":[{"isFlatFooted":false,"price":99000,"productId":4001,"quantity":1,"size":"260","width":"D"}],"orderId":1002,"paymentStatus":"NOT_REQUESTED","status":"PLACED","updatedAt":"2024-06-01T10:01:00Z","userId":2001}}],"then":[{"name":"OrderPaymentRequested","type":"Event","value":{"items":[{"isFlatFooted":false,"price":99000,"productId":4001,"quantity":1,"size":"260","width":"D"}],"orderId":1002,"paymentStatus":"REQUESTED","totalAmount":99000,"userId":2001}}],"when":[{"name":"RequestOrderPayment","type":"Command","value":{"orderId":1002}}]}],"type":"Command"},{"_type":"Command","controllerInfo":{"apiPath":"placeorder","fullApiPath":"","method":"POST"},"displayName":"주문 생성","fieldDescriptors":[{"_type":"FieldDescriptor","className":"Long","displayName":"","name":"userId"},{"_type":"FieldDescriptor","className":"List<CartItemId>","displayName":"","name":"cartItemIds"}],"isRestRepository":false,"name":"PlaceOrder","restRepositoryInfo":{"method":"POST"},"trigger":"@PrePersist","examples":[{"given":[{"name":"Order","type":"Aggregate","value":{"cartItemId":"N/A","createdAt":"2024-06-01T10:00:00Z","orderId":1001,"paymentStatus":"NOT_REQUESTED","status":"PLACED","updatedAt":"2024-06-01T10:00:00Z","userId":2001}}],"then":[{"name":"OrderPlaced","type":"Event","value":{"createdAt":"2024-06-01T10:01:00Z","items":[{"isFlatFooted":false,"price":99000,"productId":4001,"quantity":1,"size":"260","width":"D"}],"orderId":1002,"status":"PLACED","userId":2001}}],"when":[{"name":"PlaceOrder","type":"Command","value":{"cartItemIds":[{"cartItemId":3001}],"userId":2001}}]},{"given":[{"name":"Order","type":"Aggregate","value":{"cartItemId":"N/A","createdAt":"2024-06-01T10:00:00Z","orderId":1003,"paymentStatus":"NOT_REQUESTED","status":"PLACED","updatedAt":"2024-06-01T10:00:00Z","userId":2002}}],"then":[{"name":"OrderPlacementFailedDueToMissingOption","type":"Event","value":{"cartItemIds":[{"cartItemId":3002}],"errorMessage":"필수 옵션(사이즈 등)이 선택되지 않았습니다.","userId":2002}}],"when":[{"name":"PlaceOrder","type":"Command","value":{"cartItemIds":[{"cartItemId":3002}],"userId":2002}}]}],"type":"Command"},{"_type":"Command","controllerInfo":{"apiPath":"updateorderhistory","fullApiPath":"","method":"POST"},"displayName":"주문 이력 갱신","fieldDescriptors":[{"_type":"FieldDescriptor","className":"Long","displayName":"","name":"orderId"},{"_type":"FieldDescriptor","className":"OrderStatus","displayName":"","name":"status"}],"isRestRepository":false,"name":"UpdateOrderHistory","restRepositoryInfo":{"method":"POST"},"trigger":"@PrePersist","examples":[{"given":[{"name":"Order","type":"Aggregate","value":{"cartItemId":"N/A","createdAt":"2024-06-01T10:01:00Z","items":[{"isFlatFooted":false,"price":99000,"productId":4001,"quantity":1,"size":"260","width":"D"}],"orderHistory":[{"changedAt":"2024-06-01T10:04:00Z","status":"PAID"}],"orderId":1002,"paymentStatus":"COMPLETED","status":"DELIVERED","updatedAt":"2024-06-01T10:06:00Z","userId":2001}}],"then":[{"name":"OrderHistoryUpdated","type":"Event","value":{"orderId":1002,"status":"DELIVERED","updatedAt":"2024-06-01T10:07:00Z"}}],"when":[{"name":"UpdateOrderHistory","type":"Command","value":{"orderId":1002,"status":"DELIVERED"}}]}],"type":"Command"},{"_type":"Command","controllerInfo":{"apiPath":"displayorderhistory","fullApiPath":"","method":"POST"},"displayName":"주문 이력 노출","fieldDescriptors":[{"_type":"FieldDescriptor","className":"Long","displayName":"","name":"orderId"}],"isRestRepository":false,"name":"DisplayOrderHistory","restRepositoryInfo":{"method":"POST"},"trigger":"@PrePersist","examples":[{"given":[{"name":"Order","type":"Aggregate","value":{"cartItemId":"N/A","createdAt":"2024-06-01T10:01:00Z","items":[{"isFlatFooted":false,"price":99000,"productId":4001,"quantity":1,"size":"260","width":"D"}],"orderHistory":[{"changedAt":"2024-06-01T10:04:00Z","status":"PAID"},{"changedAt":"2024-06-01T10:06:00Z","status":"DELIVERED"}],"orderId":1002,"paymentStatus":"COMPLETED","status":"DELIVERED","updatedAt":"2024-06-01T10:07:00Z","userId":2001}}],"then":[{"name":"OrderHistoryDisplayed","type":"Event","value":{"displayedAt":"2024-06-01T10:08:00Z","items":[{"isFlatFooted":false,"price":99000,"productId":4001,"quantity":1,"size":"260","width":"D"}],"orderId":1002,"status":"DELIVERED","userId":2001}}],"when":[{"name":"DisplayOrderHistory","type":"Command","value":{"orderId":1002}}]}],"type":"Command"},{"_type":"Command","controllerInfo":{"apiPath":"rollbackorder","fullApiPath":"","method":"POST"},"displayName":"주문 롤백","fieldDescriptors":[{"_type":"FieldDescriptor","className":"Long","displayName":"","name":"orderId"},{"_type":"FieldDescriptor","className":"String","displayName":"","name":"rollbackReason"}],"isRestRepository":false,"name":"RollbackOrder","restRepositoryInfo":{"method":"POST"},"trigger":"@PrePersist","examples":[{"given":[{"name":"Order","type":"Aggregate","value":{"cartItemId":"N/A","createdAt":"2024-06-01T10:01:00Z","items":[{"isFlatFooted":false,"price":99000,"productId":4001,"quantity":1,"size":"260","width":"D"}],"orderId":1002,"paymentStatus":"FAILED","status":"PAYMENT_FAILED","updatedAt":"2024-06-01T10:02:00Z","userId":2001}}],"then":[{"name":"OrderRolledBack","type":"Event","value":{"orderId":1002,"rollbackReason":"결제 실패로 인한 롤백","rolledBackAt":"2024-06-01T10:03:00Z"}}],"when":[{"name":"RollbackOrder","type":"Command","value":{"orderId":1002,"rollbackReason":"결제 실패로 인한 롤백"}}]}],"type":"Command"},{"_type":"Command","controllerInfo":{"apiPath":"readyorderforshipment","fullApiPath":"","method":"POST"},"displayName":"주문 출고 준비","fieldDescriptors":[{"_type":"FieldDescriptor","className":"Long","displayName":"","name":"orderId"}],"isRestRepository":false,"name":"ReadyOrderForShipment","restRepositoryInfo":{"method":"POST"},"trigger":"@PrePersist","examples":[{"given":[{"name":"Order","type":"Aggregate","value":{"cartItemId":"N/A","createdAt":"2024-06-01T10:01:00Z","items":[{"isFlatFooted":false,"price":99000,"productId":4001,"quantity":1,"size":"260","width":"D"}],"orderId":1002,"paymentStatus":"COMPLETED","status":"PAID","updatedAt":"2024-06-01T10:04:00Z","userId":2001}}],"then":[{"name":"OrderReadyForShipment","type":"Event","value":{"items":[{"isFlatFooted":false,"price":99000,"productId":4001,"quantity":1,"size":"260","width":"D"}],"orderId":1002,"readyForShipmentAt":"2024-06-01T10:05:00Z"}}],"when":[{"name":"ReadyOrderForShipment","type":"Command","value":{"orderId":1002}}]}],"type":"Command"}]}]}],"displayName":"주문관리","name":"OrderManagement","policies":[{"_type":"Policy","displayName":"장바구니 상품 주문 생성 자동화","name":"CartItemToOrderPlacement","type":"Policy","incomingRelations":[{"source":{"_type":"Event","displayName":"장바구니에 상품이 추가됨","name":"CartItemAdded","trigger":"","incomingRelations":[{"source":{"_type":"Command","controllerInfo":{"apiPath":"addcartitem","fullApiPath":"","method":"POST"},"displayName":"장바구니에 상품 추가","isRestRepository":false,"name":"AddCartItem","restRepositoryInfo":{"method":"POST"},"trigger":"@PrePersist","examples":[{"given":[{"name":"CartItem","type":"Aggregate","value":{"cartItemId":1003,"createdAt":"2024-06-01T10:00:00Z","inventoryStockId":{"inventoryStockId":4003},"isFlatFooted":false,"productId":{"productId":3003},"quantity":0,"size":"255","status":"IN_CART","updatedAt":"2024-06-01T10:00:00Z","userId":2003,"width":"E"}}],"then":[{"name":"CartItemAdded","type":"Event","value":{"addedAt":"2024-06-01T10:10:00Z","cartItemId":1003,"inventoryStockId":{"inventoryStockId":4003},"isFlatFooted":false,"productId":{"productId":3003},"quantity":2,"size":"255","userId":2003,"width":"E"}}],"when":[{"name":"AddCartItem","type":"Command","value":{"inventoryStockId":{"inventoryStockId":4003},"isFlatFooted":false,"productId":{"productId":3003},"quantity":2,"size":"255","userId":2003,"width":"E"}}]},{"given":[{"name":"CartItem","type":"Aggregate","value":{"cartItemId":1004,"createdAt":"2024-06-01T10:00:00Z","inventoryStockId":{"inventoryStockId":4004},"isFlatFooted":true,"productId":{"productId":3004},"quantity":0,"size":"250","status":"IN_CART","updatedAt":"2024-06-01T10:00:00Z","userId":2004,"width":"D"}}],"then":[{"name":"OrderPlacementFailedDueToMissingOption","type":"Event","value":{"cartItemIds":[{"cartItemId":1004}],"errorMessage":"수량이 1개 이상이어야 합니다.","userId":2004}}],"when":[{"name":"AddCartItem","type":"Command","value":{"inventoryStockId":{"inventoryStockId":4004},"isFlatFooted":true,"productId":{"productId":3004},"quantity":0,"size":"250","userId":2004,"width":"D"}}]}],"type":"Command"}}],"type":"Event"}}]}],"readModels":[{"_type":"View","displayName":"장바구니 내역 조회","fieldDescriptors":[{"_type":"FieldDescriptor","className":"Long","name":"id"}],"name":"CartItemList","queryOption":{"apiPath":""},"queryParameters":[{"_type":"FieldDescriptor","className":"Long","displayName":"","name":"userId"},{"_type":"FieldDescriptor","className":"CartItemStatus","displayName":"","name":"status"},{"_type":"FieldDescriptor","className":"Integer","displayName":"","name":"page"},{"_type":"FieldDescriptor","className":"Integer","displayName":"","name":"size"}]},{"_type":"View","displayName":"주문 상세 조회","fieldDescriptors":[{"_type":"FieldDescriptor","className":"Long","name":"id"}],"name":"OrderDetails","queryOption":{"apiPath":""},"queryParameters":[{"_type":"FieldDescriptor","className":"Long","displayName":"","name":"orderId"}]},{"_type":"View","displayName":"주문 이력 목록 조회","fieldDescriptors":[{"_type":"FieldDescriptor","className":"Long","name":"id"}],"name":"OrderHistoryList","queryOption":{"apiPath":""},"queryParameters":[{"_type":"FieldDescriptor","className":"Long","displayName":"","name":"userId"},{"_type":"FieldDescriptor","className":"OrderStatus","displayName":"","name":"status"},{"_type":"FieldDescriptor","className":"Integer","displayName":"","name":"page"},{"_type":"FieldDescriptor","className":"Integer","displayName":"","name":"size"}]}]}
