except: false
---

Please implement DDD-based microservice architecture code for an event storming model-based domain using Spring Boot 3 and DDD Extension. The code must be implemented strictly based on the metadata provided below and @generation-rules:

ProductInventory Metadata:
{"_type":"BoundedContext","aggregates":[{"_type":"Aggregate","aggregateRoot":{"_type":"AggregateRoot","fieldDescriptors":[{"_type":"FieldDescriptor","className":"Long","displayName":"","name":"productId"},{"_type":"FieldDescriptor","className":"String","displayName":"","name":"name"},{"_type":"FieldDescriptor","className":"String","displayName":"","name":"description"},{"_type":"FieldDescriptor","className":"ProductStatus","displayName":"","name":"status"},{"_type":"FieldDescriptor","className":"ProductOptionRequiredType","displayName":"","name":"optionRequiredType"},{"_type":"FieldDescriptor","className":"Date","displayName":"","name":"createdAt"},{"_type":"FieldDescriptor","className":"Date","displayName":"","name":"updatedAt"}]},"commands":[{"_type":"Command","controllerInfo":{"apiPath":"registerproductoption","fullApiPath":"","method":"POST"},"displayName":"상품 옵션 등록","fieldDescriptors":[{"_type":"FieldDescriptor","className":"Long","displayName":"","name":"productId"},{"_type":"FieldDescriptor","className":"String","displayName":"","name":"size"},{"_type":"FieldDescriptor","className":"String","displayName":"","name":"width"},{"_type":"FieldDescriptor","className":"Boolean","displayName":"","name":"isFlatFooted"}],"isRestRepository":false,"name":"RegisterProductOption","restRepositoryInfo":{"method":"POST"},"trigger":"@PrePersist","examples":[{"given":[{"name":"Product","type":"Aggregate","value":{"createdAt":"2024-03-01T09:00:00Z","description":"편안한 남성용 스니커즈","name":"스니커즈","optionRequiredType":"REQUIRED","productId":1001,"status":"ON_SALE","updatedAt":"2024-03-01T09:00:00Z"}}],"then":[{"name":"ProductOptionRegistered","type":"Event","value":{"isFlatFooted":false,"productId":1001,"productOptionId":2001,"size":"270","width":"D"}}],"when":[{"name":"RegisterProductOption","type":"Command","value":{"isFlatFooted":false,"productId":1001,"size":"270","width":"D"}}]},{"given":[{"name":"Product","type":"Aggregate","value":{"createdAt":"2024-03-01T09:00:00Z","description":"편안한 남성용 스니커즈","name":"스니커즈","optionRequiredType":"REQUIRED","productId":1001,"status":"ON_SALE","updatedAt":"2024-03-01T09:00:00Z"}}],"then":[{"name":"ProductOptionStockInitialized","type":"Event","value":{"initialStockQuantity":50,"productId":1001,"productOptionId":2001}}],"when":[{"name":"RegisterProductOption","type":"Command","value":{"isFlatFooted":false,"productId":1001,"size":"270","width":"D"}}]},{"given":[{"name":"Product","type":"Aggregate","value":{"createdAt":"2024-03-01T09:00:00Z","description":"편안한 남성용 스니커즈","name":"스니커즈","optionRequiredType":"REQUIRED","productId":1001,"status":"ON_SALE","updatedAt":"2024-03-01T09:00:00Z"}}],"then":[{"name":"ProductOptionDisplayed","type":"Event","value":{"isFlatFooted":false,"productId":1001,"productOptionId":2001,"size":"270","width":"D"}}],"when":[{"name":"RegisterProductOption","type":"Command","value":{"isFlatFooted":false,"productId":1001,"size":"270","width":"D"}}]},{"given":[{"name":"Product","type":"Aggregate","value":{"createdAt":"2024-03-01T09:00:00Z","description":"편안한 남성용 스니커즈","name":"스니커즈","optionRequiredType":"REQUIRED","productId":1001,"status":"ON_SALE","updatedAt":"2024-03-01T09:00:00Z"}}],"then":[{"name":"ProductOptionRegistered","type":"Event","value":{"isFlatFooted":false,"productId":1001,"width":"D"}}],"when":[{"name":"RegisterProductOption","type":"Command","value":{"isFlatFooted":false,"productId":1001,"width":"D"}}]}],"type":"Command"},{"_type":"Command","controllerInfo":{"apiPath":"modifyproductoption","fullApiPath":"","method":"PATCH"},"displayName":"상품 옵션 수정","fieldDescriptors":[{"_type":"FieldDescriptor","className":"Long","displayName":"","name":"productId"},{"_type":"FieldDescriptor","className":"Long","displayName":"","name":"productOptionId"},{"_type":"FieldDescriptor","className":"String","displayName":"","name":"size"},{"_type":"FieldDescriptor","className":"String","displayName":"","name":"width"},{"_type":"FieldDescriptor","className":"Boolean","displayName":"","name":"isFlatFooted"}],"isRestRepository":false,"name":"ModifyProductOption","restRepositoryInfo":{"method":"PATCH"},"trigger":"@PrePersist","examples":[{"given":[{"name":"Product","type":"Aggregate","value":{"createdAt":"2024-03-01T09:00:00Z","description":"편안한 남성용 스니커즈","name":"스니커즈","optionRequiredType":"REQUIRED","productId":1001,"productOptionId":2001,"status":"ON_SALE","updatedAt":"2024-03-01T09:00:00Z"}}],"then":[{"name":"ProductOptionModified","type":"Event","value":{"isFlatFooted":true,"productId":1001,"productOptionId":2001,"size":"275","width":"E"}}],"when":[{"name":"ModifyProductOption","type":"Command","value":{"isFlatFooted":true,"productId":1001,"productOptionId":2001,"size":"275","width":"E"}}]},{"given":[{"name":"Product","type":"Aggregate","value":{"createdAt":"2024-03-01T09:00:00Z","description":"편안한 남성용 스니커즈","name":"스니커즈","optionRequiredType":"REQUIRED","productId":1001,"productOptionId":2001,"status":"ON_SALE","updatedAt":"2024-03-01T09:00:00Z"}}],"then":[{"name":"ProductOptionDisplayed","type":"Event","value":{"isFlatFooted":true,"productId":1001,"productOptionId":2001,"size":"275","width":"E"}}],"when":[{"name":"ModifyProductOption","type":"Command","value":{"isFlatFooted":true,"productId":1001,"productOptionId":2001,"size":"275","width":"E"}}]},{"given":[{"name":"Product","type":"Aggregate","value":{"createdAt":"2024-03-01T09:00:00Z","description":"편안한 남성용 스니커즈","name":"스니커즈","optionRequiredType":"REQUIRED","productId":1001,"status":"ON_SALE","updatedAt":"2024-03-01T09:00:00Z"}}],"then":[{"name":"ProductOptionModified","type":"Event","value":{"isFlatFooted":false,"productId":1001,"productOptionId":9999,"size":"280","width":"E"}}],"when":[{"name":"ModifyProductOption","type":"Command","value":{"isFlatFooted":false,"productId":1001,"productOptionId":9999,"size":"280","width":"E"}}]}],"type":"Command"},{"_type":"Command","controllerInfo":{"apiPath":"deleteproductoption","fullApiPath":"","method":"DELETE"},"displayName":"상품 옵션 삭제","fieldDescriptors":[{"_type":"FieldDescriptor","className":"Long","displayName":"","name":"productId"},{"_type":"FieldDescriptor","className":"Long","displayName":"","name":"productOptionId"}],"isRestRepository":false,"name":"DeleteProductOption","restRepositoryInfo":{"method":"DELETE"},"trigger":"@PrePersist","examples":[{"given":[{"name":"Product","type":"Aggregate","value":{"createdAt":"2024-03-01T09:00:00Z","description":"편안한 남성용 스니커즈","name":"스니커즈","optionRequiredType":"REQUIRED","productId":1001,"productOptionId":2001,"status":"ON_SALE","updatedAt":"2024-03-01T09:00:00Z"}}],"then":[{"name":"ProductOptionDeleted","type":"Event","value":{"productId":1001,"productOptionId":2001}}],"when":[{"name":"DeleteProductOption","type":"Command","value":{"productId":1001,"productOptionId":2001}}]},{"given":[{"name":"Product","type":"Aggregate","value":{"createdAt":"2024-03-01T09:00:00Z","description":"편안한 남성용 스니커즈","name":"스니커즈","optionRequiredType":"REQUIRED","productId":1001,"productOptionId":2001,"status":"ON_SALE","updatedAt":"2024-03-01T09:00:00Z"}}],"then":[{"name":"ProductOptionDisplayed","type":"Event","value":{"isFlatFooted":false,"productId":1001,"productOptionId":2001,"size":"270","width":"D"}}],"when":[{"name":"DeleteProductOption","type":"Command","value":{"productId":1001,"productOptionId":2001}}]},{"given":[{"name":"Product","type":"Aggregate","value":{"createdAt":"2024-03-01T09:00:00Z","description":"편안한 남성용 스니커즈","name":"스니커즈","optionRequiredType":"REQUIRED","productId":1001,"status":"ON_SALE","updatedAt":"2024-03-01T09:00:00Z"}}],"then":[{"name":"ProductOptionDeleted","type":"Event","value":{"productId":1001,"productOptionId":9999}}],"when":[{"name":"DeleteProductOption","type":"Command","value":{"productId":1001,"productOptionId":9999}}]}],"type":"Command"}],"displayName":"상품","events":[{"_type":"Event","displayName":"상품 옵션이 사용자에게 노출됨","fieldDescriptors":[{"_type":"FieldDescriptor","className":"Long","displayName":"","name":"productId"},{"_type":"FieldDescriptor","className":"Long","displayName":"","name":"productOptionId"},{"_type":"FieldDescriptor","className":"String","displayName":"","name":"size"},{"_type":"FieldDescriptor","className":"String","displayName":"","name":"width"},{"_type":"FieldDescriptor","className":"Boolean","displayName":"","name":"isFlatFooted"}],"name":"ProductOptionDisplayed","trigger":"","type":"Event"},{"_type":"Event","displayName":"상품 옵션이 삭제됨","fieldDescriptors":[{"_type":"FieldDescriptor","className":"Long","displayName":"","name":"productId"},{"_type":"FieldDescriptor","className":"Long","displayName":"","name":"productOptionId"}],"name":"ProductOptionDeleted","trigger":"","type":"Event"},{"_type":"Event","displayName":"상품 옵션이 수정됨","fieldDescriptors":[{"_type":"FieldDescriptor","className":"Long","displayName":"","name":"productId"},{"_type":"FieldDescriptor","className":"Long","displayName":"","name":"productOptionId"},{"_type":"FieldDescriptor","className":"String","displayName":"","name":"size"},{"_type":"FieldDescriptor","className":"String","displayName":"","name":"width"},{"_type":"FieldDescriptor","className":"Boolean","displayName":"","name":"isFlatFooted"}],"name":"ProductOptionModified","trigger":"","type":"Event"},{"_type":"Event","displayName":"상품 옵션이 등록됨","fieldDescriptors":[{"_type":"FieldDescriptor","className":"Long","displayName":"","name":"productId"},{"_type":"FieldDescriptor","className":"Long","displayName":"","name":"productOptionId"},{"_type":"FieldDescriptor","className":"String","displayName":"","name":"size"},{"_type":"FieldDescriptor","className":"String","displayName":"","name":"width"},{"_type":"FieldDescriptor","className":"Boolean","displayName":"","name":"isFlatFooted"}],"name":"ProductOptionRegistered","trigger":"","type":"Event"}],"name":"Product","type":"Aggregate","lifeCycles":[{"trigger":"PrePersist","commands":[{"_type":"Command","controllerInfo":{"apiPath":"registerproductoption","fullApiPath":"","method":"POST"},"displayName":"상품 옵션 등록","fieldDescriptors":[{"_type":"FieldDescriptor","className":"Long","displayName":"","name":"productId"},{"_type":"FieldDescriptor","className":"String","displayName":"","name":"size"},{"_type":"FieldDescriptor","className":"String","displayName":"","name":"width"},{"_type":"FieldDescriptor","className":"Boolean","displayName":"","name":"isFlatFooted"}],"isRestRepository":false,"name":"RegisterProductOption","restRepositoryInfo":{"method":"POST"},"trigger":"@PrePersist","examples":[{"given":[{"name":"Product","type":"Aggregate","value":{"createdAt":"2024-03-01T09:00:00Z","description":"편안한 남성용 스니커즈","name":"스니커즈","optionRequiredType":"REQUIRED","productId":1001,"status":"ON_SALE","updatedAt":"2024-03-01T09:00:00Z"}}],"then":[{"name":"ProductOptionRegistered","type":"Event","value":{"isFlatFooted":false,"productId":1001,"productOptionId":2001,"size":"270","width":"D"}}],"when":[{"name":"RegisterProductOption","type":"Command","value":{"isFlatFooted":false,"productId":1001,"size":"270","width":"D"}}]},{"given":[{"name":"Product","type":"Aggregate","value":{"createdAt":"2024-03-01T09:00:00Z","description":"편안한 남성용 스니커즈","name":"스니커즈","optionRequiredType":"REQUIRED","productId":1001,"status":"ON_SALE","updatedAt":"2024-03-01T09:00:00Z"}}],"then":[{"name":"ProductOptionStockInitialized","type":"Event","value":{"initialStockQuantity":50,"productId":1001,"productOptionId":2001}}],"when":[{"name":"RegisterProductOption","type":"Command","value":{"isFlatFooted":false,"productId":1001,"size":"270","width":"D"}}]},{"given":[{"name":"Product","type":"Aggregate","value":{"createdAt":"2024-03-01T09:00:00Z","description":"편안한 남성용 스니커즈","name":"스니커즈","optionRequiredType":"REQUIRED","productId":1001,"status":"ON_SALE","updatedAt":"2024-03-01T09:00:00Z"}}],"then":[{"name":"ProductOptionDisplayed","type":"Event","value":{"isFlatFooted":false,"productId":1001,"productOptionId":2001,"size":"270","width":"D"}}],"when":[{"name":"RegisterProductOption","type":"Command","value":{"isFlatFooted":false,"productId":1001,"size":"270","width":"D"}}]},{"given":[{"name":"Product","type":"Aggregate","value":{"createdAt":"2024-03-01T09:00:00Z","description":"편안한 남성용 스니커즈","name":"스니커즈","optionRequiredType":"REQUIRED","productId":1001,"status":"ON_SALE","updatedAt":"2024-03-01T09:00:00Z"}}],"then":[{"name":"ProductOptionRegistered","type":"Event","value":{"isFlatFooted":false,"productId":1001,"width":"D"}}],"when":[{"name":"RegisterProductOption","type":"Command","value":{"isFlatFooted":false,"productId":1001,"width":"D"}}]}],"type":"Command"},{"_type":"Command","controllerInfo":{"apiPath":"modifyproductoption","fullApiPath":"","method":"PATCH"},"displayName":"상품 옵션 수정","fieldDescriptors":[{"_type":"FieldDescriptor","className":"Long","displayName":"","name":"productId"},{"_type":"FieldDescriptor","className":"Long","displayName":"","name":"productOptionId"},{"_type":"FieldDescriptor","className":"String","displayName":"","name":"size"},{"_type":"FieldDescriptor","className":"String","displayName":"","name":"width"},{"_type":"FieldDescriptor","className":"Boolean","displayName":"","name":"isFlatFooted"}],"isRestRepository":false,"name":"ModifyProductOption","restRepositoryInfo":{"method":"PATCH"},"trigger":"@PrePersist","examples":[{"given":[{"name":"Product","type":"Aggregate","value":{"createdAt":"2024-03-01T09:00:00Z","description":"편안한 남성용 스니커즈","name":"스니커즈","optionRequiredType":"REQUIRED","productId":1001,"productOptionId":2001,"status":"ON_SALE","updatedAt":"2024-03-01T09:00:00Z"}}],"then":[{"name":"ProductOptionModified","type":"Event","value":{"isFlatFooted":true,"productId":1001,"productOptionId":2001,"size":"275","width":"E"}}],"when":[{"name":"ModifyProductOption","type":"Command","value":{"isFlatFooted":true,"productId":1001,"productOptionId":2001,"size":"275","width":"E"}}]},{"given":[{"name":"Product","type":"Aggregate","value":{"createdAt":"2024-03-01T09:00:00Z","description":"편안한 남성용 스니커즈","name":"스니커즈","optionRequiredType":"REQUIRED","productId":1001,"productOptionId":2001,"status":"ON_SALE","updatedAt":"2024-03-01T09:00:00Z"}}],"then":[{"name":"ProductOptionDisplayed","type":"Event","value":{"isFlatFooted":true,"productId":1001,"productOptionId":2001,"size":"275","width":"E"}}],"when":[{"name":"ModifyProductOption","type":"Command","value":{"isFlatFooted":true,"productId":1001,"productOptionId":2001,"size":"275","width":"E"}}]},{"given":[{"name":"Product","type":"Aggregate","value":{"createdAt":"2024-03-01T09:00:00Z","description":"편안한 남성용 스니커즈","name":"스니커즈","optionRequiredType":"REQUIRED","productId":1001,"status":"ON_SALE","updatedAt":"2024-03-01T09:00:00Z"}}],"then":[{"name":"ProductOptionModified","type":"Event","value":{"isFlatFooted":false,"productId":1001,"productOptionId":9999,"size":"280","width":"E"}}],"when":[{"name":"ModifyProductOption","type":"Command","value":{"isFlatFooted":false,"productId":1001,"productOptionId":9999,"size":"280","width":"E"}}]}],"type":"Command"},{"_type":"Command","controllerInfo":{"apiPath":"deleteproductoption","fullApiPath":"","method":"DELETE"},"displayName":"상품 옵션 삭제","fieldDescriptors":[{"_type":"FieldDescriptor","className":"Long","displayName":"","name":"productId"},{"_type":"FieldDescriptor","className":"Long","displayName":"","name":"productOptionId"}],"isRestRepository":false,"name":"DeleteProductOption","restRepositoryInfo":{"method":"DELETE"},"trigger":"@PrePersist","examples":[{"given":[{"name":"Product","type":"Aggregate","value":{"createdAt":"2024-03-01T09:00:00Z","description":"편안한 남성용 스니커즈","name":"스니커즈","optionRequiredType":"REQUIRED","productId":1001,"productOptionId":2001,"status":"ON_SALE","updatedAt":"2024-03-01T09:00:00Z"}}],"then":[{"name":"ProductOptionDeleted","type":"Event","value":{"productId":1001,"productOptionId":2001}}],"when":[{"name":"DeleteProductOption","type":"Command","value":{"productId":1001,"productOptionId":2001}}]},{"given":[{"name":"Product","type":"Aggregate","value":{"createdAt":"2024-03-01T09:00:00Z","description":"편안한 남성용 스니커즈","name":"스니커즈","optionRequiredType":"REQUIRED","productId":1001,"productOptionId":2001,"status":"ON_SALE","updatedAt":"2024-03-01T09:00:00Z"}}],"then":[{"name":"ProductOptionDisplayed","type":"Event","value":{"isFlatFooted":false,"productId":1001,"productOptionId":2001,"size":"270","width":"D"}}],"when":[{"name":"DeleteProductOption","type":"Command","value":{"productId":1001,"productOptionId":2001}}]},{"given":[{"name":"Product","type":"Aggregate","value":{"createdAt":"2024-03-01T09:00:00Z","description":"편안한 남성용 스니커즈","name":"스니커즈","optionRequiredType":"REQUIRED","productId":1001,"status":"ON_SALE","updatedAt":"2024-03-01T09:00:00Z"}}],"then":[{"name":"ProductOptionDeleted","type":"Event","value":{"productId":1001,"productOptionId":9999}}],"when":[{"name":"DeleteProductOption","type":"Command","value":{"productId":1001,"productOptionId":9999}}]}],"type":"Command"}]}]},{"_type":"Aggregate","aggregateRoot":{"_type":"AggregateRoot","fieldDescriptors":[{"_type":"FieldDescriptor","className":"Long","displayName":"","name":"productOptionId"},{"_type":"FieldDescriptor","className":"Long","displayName":"","name":"productId"},{"_type":"FieldDescriptor","className":"String","displayName":"","name":"size"},{"_type":"FieldDescriptor","className":"String","displayName":"","name":"width"},{"_type":"FieldDescriptor","className":"Boolean","displayName":"","name":"isFlatFooted"},{"_type":"FieldDescriptor","className":"Integer","displayName":"","name":"stockQuantity"},{"_type":"FieldDescriptor","className":"OptionSoldOutStatus","displayName":"","name":"soldOutStatus"},{"_type":"FieldDescriptor","className":"Date","displayName":"","name":"createdAt"},{"_type":"FieldDescriptor","className":"Date","displayName":"","name":"updatedAt"}]},"commands":[{"_type":"Command","controllerInfo":{"apiPath":"markproductoptionsoldout","fullApiPath":"","method":"PATCH"},"displayName":"상품 옵션 품절 처리","fieldDescriptors":[{"_type":"FieldDescriptor","className":"Long","displayName":"","name":"productOptionId"}],"isRestRepository":false,"name":"MarkProductOptionSoldOut","restRepositoryInfo":{"method":"PATCH"},"trigger":"@PrePersist","examples":[{"given":[{"name":"ProductOption","type":"Aggregate","value":{"createdAt":"N/A","isFlatFooted":false,"productId":2001,"productOptionId":1001,"size":"270","soldOutStatus":"IN_STOCK","stockQuantity":0,"updatedAt":"N/A","width":"Wide"}}],"then":[{"name":"ProductOptionSoldOut","type":"Event","value":{"isFlatFooted":false,"productId":2001,"productOptionId":1001,"size":"270","soldOutAt":"2024-06-01T10:00:00Z","width":"Wide"}}],"when":[{"name":"MarkProductOptionSoldOut","type":"Command","value":{"productOptionId":1001}}]},{"given":[{"name":"ProductOption","type":"Aggregate","value":{"createdAt":"N/A","isFlatFooted":true,"productId":2002,"productOptionId":1002,"size":"260","soldOutStatus":"SOLD_OUT","stockQuantity":0,"updatedAt":"N/A","width":"Regular"}}],"then":[{"name":"ProductOptionSoldOut","type":"Event","value":{"isFlatFooted":true,"productId":2002,"productOptionId":1002,"size":"260","soldOutAt":"2024-06-01T10:00:00Z","width":"Regular"}}],"when":[{"name":"MarkProductOptionSoldOut","type":"Command","value":{"productOptionId":1002}}]},{"given":[{"name":"ProductOption","type":"Aggregate","value":{"createdAt":"N/A","isFlatFooted":false,"productId":2003,"productOptionId":1003,"size":"255","soldOutStatus":"IN_STOCK","stockQuantity":0,"updatedAt":"N/A","width":"Narrow"}}],"then":[{"name":"ProductOptionSoldOut","type":"Event","value":{"isFlatFooted":false,"productId":2003,"productOptionId":1003,"size":"255","soldOutAt":"2024-06-01T10:00:00Z","width":"Narrow"}}],"when":[{"name":"MarkProductOptionSoldOut","type":"Command","value":{"productOptionId":1003}}]}],"type":"Command"}],"displayName":"상품옵션","events":[{"_type":"Event","displayName":"상품 옵션이 품절됨","fieldDescriptors":[{"_type":"FieldDescriptor","className":"Long","displayName":"","name":"productOptionId"},{"_type":"FieldDescriptor","className":"Long","displayName":"","name":"productId"},{"_type":"FieldDescriptor","className":"String","displayName":"","name":"size"},{"_type":"FieldDescriptor","className":"String","displayName":"","name":"width"},{"_type":"FieldDescriptor","className":"Boolean","displayName":"","name":"isFlatFooted"},{"_type":"FieldDescriptor","className":"Date","displayName":"","name":"soldOutAt"}],"name":"ProductOptionSoldOut","trigger":"","type":"Event"}],"name":"ProductOption","type":"Aggregate","lifeCycles":[{"trigger":"PrePersist","commands":[{"_type":"Command","controllerInfo":{"apiPath":"markproductoptionsoldout","fullApiPath":"","method":"PATCH"},"displayName":"상품 옵션 품절 처리","fieldDescriptors":[{"_type":"FieldDescriptor","className":"Long","displayName":"","name":"productOptionId"}],"isRestRepository":false,"name":"MarkProductOptionSoldOut","restRepositoryInfo":{"method":"PATCH"},"trigger":"@PrePersist","examples":[{"given":[{"name":"ProductOption","type":"Aggregate","value":{"createdAt":"N/A","isFlatFooted":false,"productId":2001,"productOptionId":1001,"size":"270","soldOutStatus":"IN_STOCK","stockQuantity":0,"updatedAt":"N/A","width":"Wide"}}],"then":[{"name":"ProductOptionSoldOut","type":"Event","value":{"isFlatFooted":false,"productId":2001,"productOptionId":1001,"size":"270","soldOutAt":"2024-06-01T10:00:00Z","width":"Wide"}}],"when":[{"name":"MarkProductOptionSoldOut","type":"Command","value":{"productOptionId":1001}}]},{"given":[{"name":"ProductOption","type":"Aggregate","value":{"createdAt":"N/A","isFlatFooted":true,"productId":2002,"productOptionId":1002,"size":"260","soldOutStatus":"SOLD_OUT","stockQuantity":0,"updatedAt":"N/A","width":"Regular"}}],"then":[{"name":"ProductOptionSoldOut","type":"Event","value":{"isFlatFooted":true,"productId":2002,"productOptionId":1002,"size":"260","soldOutAt":"2024-06-01T10:00:00Z","width":"Regular"}}],"when":[{"name":"MarkProductOptionSoldOut","type":"Command","value":{"productOptionId":1002}}]},{"given":[{"name":"ProductOption","type":"Aggregate","value":{"createdAt":"N/A","isFlatFooted":false,"productId":2003,"productOptionId":1003,"size":"255","soldOutStatus":"IN_STOCK","stockQuantity":0,"updatedAt":"N/A","width":"Narrow"}}],"then":[{"name":"ProductOptionSoldOut","type":"Event","value":{"isFlatFooted":false,"productId":2003,"productOptionId":1003,"size":"255","soldOutAt":"2024-06-01T10:00:00Z","width":"Narrow"}}],"when":[{"name":"MarkProductOptionSoldOut","type":"Command","value":{"productOptionId":1003}}]}],"type":"Command"}]}]},{"_type":"Aggregate","aggregateRoot":{"_type":"AggregateRoot","fieldDescriptors":[{"_type":"FieldDescriptor","className":"Long","displayName":"","name":"inventoryStockId"},{"_type":"FieldDescriptor","className":"Long","displayName":"","name":"productId"},{"_type":"FieldDescriptor","className":"String","displayName":"","name":"size"},{"_type":"FieldDescriptor","className":"String","displayName":"","name":"width"},{"_type":"FieldDescriptor","className":"Boolean","displayName":"","name":"isFlatFooted"},{"_type":"FieldDescriptor","className":"Integer","displayName":"","name":"stockQuantity"},{"_type":"FieldDescriptor","className":"StockStatus","displayName":"","name":"status"},{"_type":"FieldDescriptor","className":"Date","displayName":"","name":"createdAt"},{"_type":"FieldDescriptor","className":"Date","displayName":"","name":"updatedAt"},{"_type":"FieldDescriptor","name":"productOptionId","className":"ProductOptionId","displayName":"상품옵션 ID"}]},"commands":[{"_type":"Command","controllerInfo":{"apiPath":"modifyproductoptionstock","fullApiPath":"","method":"PATCH"},"displayName":"상품 옵션 재고 수정","fieldDescriptors":[{"_type":"FieldDescriptor","className":"Long","displayName":"","name":"inventoryStockId"},{"_type":"FieldDescriptor","className":"Integer","displayName":"","name":"modifiedStockQuantity"}],"isRestRepository":false,"name":"ModifyProductOptionStock","restRepositoryInfo":{"method":"PATCH"},"trigger":"@PrePersist","examples":[{"given":[{"name":"InventoryStock","type":"Aggregate","value":{"createdAt":"N/A","inventoryStockId":1002,"isFlatFooted":true,"productId":2002,"productOptionId":{"productOptionId":3002},"size":"265","status":"IN_STOCK","stockQuantity":10,"updatedAt":"N/A","width":"Normal"}}],"then":[{"name":"ProductOptionStockModified","type":"Event","value":{"inventoryStockId":1002,"modifiedAt":"2024-06-01T10:00:00Z","productId":2002,"productOptionId":3002,"stockQuantity":5}}],"when":[{"name":"ModifyProductOptionStock","type":"Command","value":{"inventoryStockId":1002,"modifiedStockQuantity":5}}]},{"given":[{"name":"InventoryStock","type":"Aggregate","value":{"createdAt":"N/A","inventoryStockId":1003,"isFlatFooted":false,"productId":2003,"productOptionId":{"productOptionId":3003},"size":"270","status":"SOLD_OUT","stockQuantity":0,"updatedAt":"N/A","width":"Wide"}}],"then":[{"name":"ProductOptionStockModified","type":"Event","value":{"inventoryStockId":1003,"modifiedAt":"2024-06-01T10:00:00Z","productId":2003,"productOptionId":3003,"stockQuantity":10}}],"when":[{"name":"ModifyProductOptionStock","type":"Command","value":{"inventoryStockId":1003,"modifiedStockQuantity":10}}]}],"type":"Command"},{"_type":"Command","controllerInfo":{"apiPath":"initializeproductoptionstock","fullApiPath":"","method":"POST"},"displayName":"상품 옵션 재고 초기화","fieldDescriptors":[{"_type":"FieldDescriptor","className":"Long","displayName":"","name":"inventoryStockId"},{"_type":"FieldDescriptor","className":"Long","displayName":"","name":"productId"},{"_type":"FieldDescriptor","className":"ProductOptionId","displayName":"","name":"productOptionId"},{"_type":"FieldDescriptor","className":"String","displayName":"","name":"size"},{"_type":"FieldDescriptor","className":"String","displayName":"","name":"width"},{"_type":"FieldDescriptor","className":"Boolean","displayName":"","name":"isFlatFooted"},{"_type":"FieldDescriptor","className":"Integer","displayName":"","name":"initialStockQuantity"}],"isRestRepository":false,"name":"InitializeProductOptionStock","restRepositoryInfo":{"method":"POST"},"trigger":"@PrePersist","examples":[{"given":[{"name":"InventoryStock","type":"Aggregate","value":{"createdAt":"N/A","inventoryStockId":1001,"isFlatFooted":false,"productId":2001,"productOptionId":{"productOptionId":3001},"size":"260","status":"IN_STOCK","stockQuantity":0,"updatedAt":"N/A","width":"Wide"}}],"then":[{"name":"ProductOptionStockInitialized","type":"Event","value":{"initialStockQuantity":20,"productId":2001,"productOptionId":3001}}],"when":[{"name":"InitializeProductOptionStock","type":"Command","value":{"initialStockQuantity":20,"inventoryStockId":1001,"isFlatFooted":false,"productId":2001,"productOptionId":{"productOptionId":3001},"size":"260","width":"Wide"}}]}],"type":"Command"},{"_type":"Command","controllerInfo":{"apiPath":"increaseoptionstock","fullApiPath":"","method":"POST"},"displayName":"옵션별 재고 증가","fieldDescriptors":[{"_type":"FieldDescriptor","className":"Long","displayName":"","name":"inventoryStockId"},{"_type":"FieldDescriptor","className":"Integer","displayName":"","name":"increasedQuantity"},{"_type":"FieldDescriptor","className":"String","displayName":"","name":"reason"}],"isRestRepository":false,"name":"IncreaseOptionStock","restRepositoryInfo":{"method":"POST"},"trigger":"@PrePersist","examples":[{"given":[{"name":"InventoryStock","type":"Aggregate","value":{"createdAt":"N/A","inventoryStockId":1006,"isFlatFooted":false,"productId":2006,"productOptionId":{"productOptionId":3006},"size":"260","status":"SOLD_OUT","stockQuantity":0,"updatedAt":"N/A","width":"Normal"}}],"then":[{"name":"OptionStockIncreased","type":"Event","value":{"increasedAt":"2024-06-01T10:03:00Z","increasedQuantity":5,"inventoryStockId":1006,"productId":2006,"productOptionId":3006,"reason":"반품 처리","stockQuantity":5}}],"when":[{"name":"IncreaseOptionStock","type":"Command","value":{"increasedQuantity":5,"inventoryStockId":1006,"reason":"반품 처리"}}]}],"type":"Command"},{"_type":"Command","controllerInfo":{"apiPath":"decreaseoptionstock","fullApiPath":"","method":"POST"},"displayName":"옵션별 재고 차감","fieldDescriptors":[{"_type":"FieldDescriptor","className":"Long","displayName":"","name":"inventoryStockId"},{"_type":"FieldDescriptor","className":"Integer","displayName":"","name":"decreasedQuantity"},{"_type":"FieldDescriptor","className":"Long","displayName":"","name":"orderId"}],"isRestRepository":false,"name":"DecreaseOptionStock","restRepositoryInfo":{"method":"POST"},"trigger":"@PrePersist","examples":[{"given":[{"name":"InventoryStock","type":"Aggregate","value":{"createdAt":"N/A","inventoryStockId":1004,"isFlatFooted":false,"productId":2004,"productOptionId":{"productOptionId":3004},"size":"255","status":"IN_STOCK","stockQuantity":5,"updatedAt":"N/A","width":"Normal"}}],"then":[{"name":"OptionStockDecreased","type":"Event","value":{"decreasedAt":"2024-06-01T10:01:00Z","decreasedQuantity":2,"inventoryStockId":1004,"orderId":4001,"productId":2004,"productOptionId":3004,"stockQuantity":3}}],"when":[{"name":"DecreaseOptionStock","type":"Command","value":{"decreasedQuantity":2,"inventoryStockId":1004,"orderId":4001}}]},{"given":[{"name":"InventoryStock","type":"Aggregate","value":{"createdAt":"N/A","inventoryStockId":1005,"isFlatFooted":true,"productId":2005,"productOptionId":{"productOptionId":3005},"size":"250","status":"IN_STOCK","stockQuantity":1,"updatedAt":"N/A","width":"Wide"}}],"then":[{"name":"OptionStockDecreased","type":"Event","value":{"decreasedAt":"2024-06-01T10:02:00Z","decreasedQuantity":1,"inventoryStockId":1005,"orderId":4002,"productId":2005,"productOptionId":3005,"stockQuantity":0}}],"when":[{"name":"DecreaseOptionStock","type":"Command","value":{"decreasedQuantity":1,"inventoryStockId":1005,"orderId":4002}}]}],"type":"Command"}],"displayName":"옵션별재고","events":[{"_type":"Event","displayName":"옵션별 재고가 차감됨","fieldDescriptors":[{"_type":"FieldDescriptor","className":"Long","displayName":"","name":"inventoryStockId"},{"_type":"FieldDescriptor","className":"Long","displayName":"","name":"productId"},{"_type":"FieldDescriptor","className":"ProductOptionId","displayName":"","name":"productOptionId"},{"_type":"FieldDescriptor","className":"Integer","displayName":"","name":"decreasedQuantity"},{"_type":"FieldDescriptor","className":"Integer","displayName":"","name":"stockQuantity"},{"_type":"FieldDescriptor","className":"Long","displayName":"","name":"orderId"},{"_type":"FieldDescriptor","className":"Date","displayName":"","name":"decreasedAt"}],"name":"OptionStockDecreased","trigger":"","type":"Event"},{"_type":"Event","displayName":"옵션별 재고 정보가 사용자에게 노출됨","fieldDescriptors":[{"_type":"FieldDescriptor","className":"Long","displayName":"","name":"inventoryStockId"},{"_type":"FieldDescriptor","className":"Long","displayName":"","name":"productId"},{"_type":"FieldDescriptor","className":"ProductOptionId","displayName":"","name":"productOptionId"},{"_type":"FieldDescriptor","className":"String","displayName":"","name":"size"},{"_type":"FieldDescriptor","className":"String","displayName":"","name":"width"},{"_type":"FieldDescriptor","className":"Boolean","displayName":"","name":"isFlatFooted"},{"_type":"FieldDescriptor","className":"Integer","displayName":"","name":"stockQuantity"},{"_type":"FieldDescriptor","className":"StockStatus","displayName":"","name":"soldOutStatus"},{"_type":"FieldDescriptor","className":"Date","displayName":"","name":"displayedAt"}],"name":"OptionStockDisplayed","trigger":"","type":"Event"},{"_type":"Event","displayName":"옵션별 재고가 증가됨","fieldDescriptors":[{"_type":"FieldDescriptor","className":"Long","displayName":"","name":"inventoryStockId"},{"_type":"FieldDescriptor","className":"Long","displayName":"","name":"productId"},{"_type":"FieldDescriptor","className":"ProductOptionId","displayName":"","name":"productOptionId"},{"_type":"FieldDescriptor","className":"Integer","displayName":"","name":"increasedQuantity"},{"_type":"FieldDescriptor","className":"Integer","displayName":"","name":"stockQuantity"},{"_type":"FieldDescriptor","className":"String","displayName":"","name":"reason"},{"_type":"FieldDescriptor","className":"Date","displayName":"","name":"increasedAt"}],"name":"OptionStockIncreased","trigger":"","type":"Event"},{"_type":"Event","displayName":"상품 옵션 재고가 수정됨","fieldDescriptors":[{"_type":"FieldDescriptor","className":"Long","displayName":"","name":"inventoryStockId"},{"_type":"FieldDescriptor","className":"Long","displayName":"","name":"productId"},{"_type":"FieldDescriptor","className":"ProductOptionId","displayName":"","name":"productOptionId"},{"_type":"FieldDescriptor","className":"Integer","displayName":"","name":"stockQuantity"},{"_type":"FieldDescriptor","className":"Date","displayName":"","name":"modifiedAt"}],"name":"ProductOptionStockModified","trigger":"","type":"Event"}],"name":"InventoryStock","type":"Aggregate","lifeCycles":[{"trigger":"PrePersist","commands":[{"_type":"Command","controllerInfo":{"apiPath":"modifyproductoptionstock","fullApiPath":"","method":"PATCH"},"displayName":"상품 옵션 재고 수정","fieldDescriptors":[{"_type":"FieldDescriptor","className":"Long","displayName":"","name":"inventoryStockId"},{"_type":"FieldDescriptor","className":"Integer","displayName":"","name":"modifiedStockQuantity"}],"isRestRepository":false,"name":"ModifyProductOptionStock","restRepositoryInfo":{"method":"PATCH"},"trigger":"@PrePersist","examples":[{"given":[{"name":"InventoryStock","type":"Aggregate","value":{"createdAt":"N/A","inventoryStockId":1002,"isFlatFooted":true,"productId":2002,"productOptionId":{"productOptionId":3002},"size":"265","status":"IN_STOCK","stockQuantity":10,"updatedAt":"N/A","width":"Normal"}}],"then":[{"name":"ProductOptionStockModified","type":"Event","value":{"inventoryStockId":1002,"modifiedAt":"2024-06-01T10:00:00Z","productId":2002,"productOptionId":3002,"stockQuantity":5}}],"when":[{"name":"ModifyProductOptionStock","type":"Command","value":{"inventoryStockId":1002,"modifiedStockQuantity":5}}]},{"given":[{"name":"InventoryStock","type":"Aggregate","value":{"createdAt":"N/A","inventoryStockId":1003,"isFlatFooted":false,"productId":2003,"productOptionId":{"productOptionId":3003},"size":"270","status":"SOLD_OUT","stockQuantity":0,"updatedAt":"N/A","width":"Wide"}}],"then":[{"name":"ProductOptionStockModified","type":"Event","value":{"inventoryStockId":1003,"modifiedAt":"2024-06-01T10:00:00Z","productId":2003,"productOptionId":3003,"stockQuantity":10}}],"when":[{"name":"ModifyProductOptionStock","type":"Command","value":{"inventoryStockId":1003,"modifiedStockQuantity":10}}]}],"type":"Command"},{"_type":"Command","controllerInfo":{"apiPath":"initializeproductoptionstock","fullApiPath":"","method":"POST"},"displayName":"상품 옵션 재고 초기화","fieldDescriptors":[{"_type":"FieldDescriptor","className":"Long","displayName":"","name":"inventoryStockId"},{"_type":"FieldDescriptor","className":"Long","displayName":"","name":"productId"},{"_type":"FieldDescriptor","className":"ProductOptionId","displayName":"","name":"productOptionId"},{"_type":"FieldDescriptor","className":"String","displayName":"","name":"size"},{"_type":"FieldDescriptor","className":"String","displayName":"","name":"width"},{"_type":"FieldDescriptor","className":"Boolean","displayName":"","name":"isFlatFooted"},{"_type":"FieldDescriptor","className":"Integer","displayName":"","name":"initialStockQuantity"}],"isRestRepository":false,"name":"InitializeProductOptionStock","restRepositoryInfo":{"method":"POST"},"trigger":"@PrePersist","examples":[{"given":[{"name":"InventoryStock","type":"Aggregate","value":{"createdAt":"N/A","inventoryStockId":1001,"isFlatFooted":false,"productId":2001,"productOptionId":{"productOptionId":3001},"size":"260","status":"IN_STOCK","stockQuantity":0,"updatedAt":"N/A","width":"Wide"}}],"then":[{"name":"ProductOptionStockInitialized","type":"Event","value":{"initialStockQuantity":20,"productId":2001,"productOptionId":3001}}],"when":[{"name":"InitializeProductOptionStock","type":"Command","value":{"initialStockQuantity":20,"inventoryStockId":1001,"isFlatFooted":false,"productId":2001,"productOptionId":{"productOptionId":3001},"size":"260","width":"Wide"}}]}],"type":"Command"},{"_type":"Command","controllerInfo":{"apiPath":"increaseoptionstock","fullApiPath":"","method":"POST"},"displayName":"옵션별 재고 증가","fieldDescriptors":[{"_type":"FieldDescriptor","className":"Long","displayName":"","name":"inventoryStockId"},{"_type":"FieldDescriptor","className":"Integer","displayName":"","name":"increasedQuantity"},{"_type":"FieldDescriptor","className":"String","displayName":"","name":"reason"}],"isRestRepository":false,"name":"IncreaseOptionStock","restRepositoryInfo":{"method":"POST"},"trigger":"@PrePersist","examples":[{"given":[{"name":"InventoryStock","type":"Aggregate","value":{"createdAt":"N/A","inventoryStockId":1006,"isFlatFooted":false,"productId":2006,"productOptionId":{"productOptionId":3006},"size":"260","status":"SOLD_OUT","stockQuantity":0,"updatedAt":"N/A","width":"Normal"}}],"then":[{"name":"OptionStockIncreased","type":"Event","value":{"increasedAt":"2024-06-01T10:03:00Z","increasedQuantity":5,"inventoryStockId":1006,"productId":2006,"productOptionId":3006,"reason":"반품 처리","stockQuantity":5}}],"when":[{"name":"IncreaseOptionStock","type":"Command","value":{"increasedQuantity":5,"inventoryStockId":1006,"reason":"반품 처리"}}]}],"type":"Command"},{"_type":"Command","controllerInfo":{"apiPath":"decreaseoptionstock","fullApiPath":"","method":"POST"},"displayName":"옵션별 재고 차감","fieldDescriptors":[{"_type":"FieldDescriptor","className":"Long","displayName":"","name":"inventoryStockId"},{"_type":"FieldDescriptor","className":"Integer","displayName":"","name":"decreasedQuantity"},{"_type":"FieldDescriptor","className":"Long","displayName":"","name":"orderId"}],"isRestRepository":false,"name":"DecreaseOptionStock","restRepositoryInfo":{"method":"POST"},"trigger":"@PrePersist","examples":[{"given":[{"name":"InventoryStock","type":"Aggregate","value":{"createdAt":"N/A","inventoryStockId":1004,"isFlatFooted":false,"productId":2004,"productOptionId":{"productOptionId":3004},"size":"255","status":"IN_STOCK","stockQuantity":5,"updatedAt":"N/A","width":"Normal"}}],"then":[{"name":"OptionStockDecreased","type":"Event","value":{"decreasedAt":"2024-06-01T10:01:00Z","decreasedQuantity":2,"inventoryStockId":1004,"orderId":4001,"productId":2004,"productOptionId":3004,"stockQuantity":3}}],"when":[{"name":"DecreaseOptionStock","type":"Command","value":{"decreasedQuantity":2,"inventoryStockId":1004,"orderId":4001}}]},{"given":[{"name":"InventoryStock","type":"Aggregate","value":{"createdAt":"N/A","inventoryStockId":1005,"isFlatFooted":true,"productId":2005,"productOptionId":{"productOptionId":3005},"size":"250","status":"IN_STOCK","stockQuantity":1,"updatedAt":"N/A","width":"Wide"}}],"then":[{"name":"OptionStockDecreased","type":"Event","value":{"decreasedAt":"2024-06-01T10:02:00Z","decreasedQuantity":1,"inventoryStockId":1005,"orderId":4002,"productId":2005,"productOptionId":3005,"stockQuantity":0}}],"when":[{"name":"DecreaseOptionStock","type":"Command","value":{"decreasedQuantity":1,"inventoryStockId":1005,"orderId":4002}}]}],"type":"Command"}]}]}],"displayName":"상품/재고관리","name":"ProductInventory","policies":[{"_type":"Policy","displayName":"주문 생성 시 옵션 재고 차감","name":"OrderPlacementToStockDecrease","incomingRelations":[{"source":{"_type":"Event","displayName":"주문이 생성됨","name":"OrderPlaced","trigger":"","incomingRelations":[{"source":{"_type":"Command","controllerInfo":{"apiPath":"placeorder","fullApiPath":"","method":"POST"},"displayName":"주문 생성","isRestRepository":false,"name":"PlaceOrder","restRepositoryInfo":{"method":"POST"},"trigger":"@PrePersist","examples":[{"given":[{"name":"Order","type":"Aggregate","value":{"cartItemId":"N/A","createdAt":"2024-06-01T10:00:00Z","orderId":1001,"paymentStatus":"NOT_REQUESTED","status":"PLACED","updatedAt":"2024-06-01T10:00:00Z","userId":2001}}],"then":[{"name":"OrderPlaced","type":"Event","value":{"createdAt":"2024-06-01T10:01:00Z","items":[{"isFlatFooted":false,"price":99000,"productId":4001,"quantity":1,"size":"260","width":"D"}],"orderId":1002,"status":"PLACED","userId":2001}}],"when":[{"name":"PlaceOrder","type":"Command","value":{"cartItemIds":[{"cartItemId":3001}],"userId":2001}}]},{"given":[{"name":"Order","type":"Aggregate","value":{"cartItemId":"N/A","createdAt":"2024-06-01T10:00:00Z","orderId":1003,"paymentStatus":"NOT_REQUESTED","status":"PLACED","updatedAt":"2024-06-01T10:00:00Z","userId":2002}}],"then":[{"name":"OrderPlacementFailedDueToMissingOption","type":"Event","value":{"cartItemIds":[{"cartItemId":3002}],"errorMessage":"필수 옵션(사이즈 등)이 선택되지 않았습니다.","userId":2002}}],"when":[{"name":"PlaceOrder","type":"Command","value":{"cartItemIds":[{"cartItemId":3002}],"userId":2002}}]}],"type":"Command"}},{"source":{"_type":"Policy","displayName":"장바구니 상품 주문 생성 자동화","name":"CartItemToOrderPlacement","type":"Policy","incomingRelations":[{"source":{"_type":"Event","displayName":"장바구니에 상품이 추가됨","name":"CartItemAdded","trigger":"","incomingRelations":[{"source":{"_type":"Command","controllerInfo":{"apiPath":"addcartitem","fullApiPath":"","method":"POST"},"displayName":"장바구니에 상품 추가","isRestRepository":false,"name":"AddCartItem","restRepositoryInfo":{"method":"POST"},"trigger":"@PrePersist","examples":[{"given":[{"name":"CartItem","type":"Aggregate","value":{"cartItemId":1003,"createdAt":"2024-06-01T10:00:00Z","inventoryStockId":{"inventoryStockId":4003},"isFlatFooted":false,"productId":{"productId":3003},"quantity":0,"size":"255","status":"IN_CART","updatedAt":"2024-06-01T10:00:00Z","userId":2003,"width":"E"}}],"then":[{"name":"CartItemAdded","type":"Event","value":{"addedAt":"2024-06-01T10:10:00Z","cartItemId":1003,"inventoryStockId":{"inventoryStockId":4003},"isFlatFooted":false,"productId":{"productId":3003},"quantity":2,"size":"255","userId":2003,"width":"E"}}],"when":[{"name":"AddCartItem","type":"Command","value":{"inventoryStockId":{"inventoryStockId":4003},"isFlatFooted":false,"productId":{"productId":3003},"quantity":2,"size":"255","userId":2003,"width":"E"}}]},{"given":[{"name":"CartItem","type":"Aggregate","value":{"cartItemId":1004,"createdAt":"2024-06-01T10:00:00Z","inventoryStockId":{"inventoryStockId":4004},"isFlatFooted":true,"productId":{"productId":3004},"quantity":0,"size":"250","status":"IN_CART","updatedAt":"2024-06-01T10:00:00Z","userId":2004,"width":"D"}}],"then":[{"name":"OrderPlacementFailedDueToMissingOption","type":"Event","value":{"cartItemIds":[{"cartItemId":1004}],"errorMessage":"수량이 1개 이상이어야 합니다.","userId":2004}}],"when":[{"name":"AddCartItem","type":"Command","value":{"inventoryStockId":{"inventoryStockId":4004},"isFlatFooted":true,"productId":{"productId":3004},"quantity":0,"size":"250","userId":2004,"width":"D"}}]}],"type":"Command"}}],"type":"Event"}}]}}],"type":"Event"}}],"type":"Policy"},{"_type":"Policy","displayName":"품절 시 안내 메시지 노출","name":"DisplaySoldOutMessageOnSoldOut","type":"Policy","incomingRelations":[{"source":{"_type":"Event","displayName":"상품 옵션이 품절됨","name":"ProductOptionSoldOut","trigger":"","incomingRelations":[{"source":{"_type":"Command","controllerInfo":{"apiPath":"markproductoptionsoldout","fullApiPath":"","method":"PATCH"},"displayName":"상품 옵션 품절 처리","isRestRepository":false,"name":"MarkProductOptionSoldOut","restRepositoryInfo":{"method":"PATCH"},"trigger":"@PrePersist","examples":[{"given":[{"name":"ProductOption","type":"Aggregate","value":{"createdAt":"N/A","isFlatFooted":false,"productId":2001,"productOptionId":1001,"size":"270","soldOutStatus":"IN_STOCK","stockQuantity":0,"updatedAt":"N/A","width":"Wide"}}],"then":[{"name":"ProductOptionSoldOut","type":"Event","value":{"isFlatFooted":false,"productId":2001,"productOptionId":1001,"size":"270","soldOutAt":"2024-06-01T10:00:00Z","width":"Wide"}}],"when":[{"name":"MarkProductOptionSoldOut","type":"Command","value":{"productOptionId":1001}}]},{"given":[{"name":"ProductOption","type":"Aggregate","value":{"createdAt":"N/A","isFlatFooted":true,"productId":2002,"productOptionId":1002,"size":"260","soldOutStatus":"SOLD_OUT","stockQuantity":0,"updatedAt":"N/A","width":"Regular"}}],"then":[{"name":"ProductOptionSoldOut","type":"Event","value":{"isFlatFooted":true,"productId":2002,"productOptionId":1002,"size":"260","soldOutAt":"2024-06-01T10:00:00Z","width":"Regular"}}],"when":[{"name":"MarkProductOptionSoldOut","type":"Command","value":{"productOptionId":1002}}]},{"given":[{"name":"ProductOption","type":"Aggregate","value":{"createdAt":"N/A","isFlatFooted":false,"productId":2003,"productOptionId":1003,"size":"255","soldOutStatus":"IN_STOCK","stockQuantity":0,"updatedAt":"N/A","width":"Narrow"}}],"then":[{"name":"ProductOptionSoldOut","type":"Event","value":{"isFlatFooted":false,"productId":2003,"productOptionId":1003,"size":"255","soldOutAt":"2024-06-01T10:00:00Z","width":"Narrow"}}],"when":[{"name":"MarkProductOptionSoldOut","type":"Command","value":{"productOptionId":1003}}]}],"type":"Command"}},{"source":{"_type":"Policy","displayName":"재고 소진 시 품절 처리","name":"MarkOptionSoldOutOnStockDepletion","incomingRelations":[{"source":{"_type":"Event","displayName":"옵션별 재고가 차감됨","name":"OptionStockDecreased","trigger":"","incomingRelations":[{"source":{"_type":"Command","controllerInfo":{"apiPath":"decreaseoptionstock","fullApiPath":"","method":"POST"},"displayName":"옵션별 재고 차감","isRestRepository":false,"name":"DecreaseOptionStock","restRepositoryInfo":{"method":"POST"},"trigger":"@PrePersist","examples":[{"given":[{"name":"InventoryStock","type":"Aggregate","value":{"createdAt":"N/A","inventoryStockId":1004,"isFlatFooted":false,"productId":2004,"productOptionId":{"productOptionId":3004},"size":"255","status":"IN_STOCK","stockQuantity":5,"updatedAt":"N/A","width":"Normal"}}],"then":[{"name":"OptionStockDecreased","type":"Event","value":{"decreasedAt":"2024-06-01T10:01:00Z","decreasedQuantity":2,"inventoryStockId":1004,"orderId":4001,"productId":2004,"productOptionId":3004,"stockQuantity":3}}],"when":[{"name":"DecreaseOptionStock","type":"Command","value":{"decreasedQuantity":2,"inventoryStockId":1004,"orderId":4001}}]},{"given":[{"name":"InventoryStock","type":"Aggregate","value":{"createdAt":"N/A","inventoryStockId":1005,"isFlatFooted":true,"productId":2005,"productOptionId":{"productOptionId":3005},"size":"250","status":"IN_STOCK","stockQuantity":1,"updatedAt":"N/A","width":"Wide"}}],"then":[{"name":"OptionStockDecreased","type":"Event","value":{"decreasedAt":"2024-06-01T10:02:00Z","decreasedQuantity":1,"inventoryStockId":1005,"orderId":4002,"productId":2005,"productOptionId":3005,"stockQuantity":0}}],"when":[{"name":"DecreaseOptionStock","type":"Command","value":{"decreasedQuantity":1,"inventoryStockId":1005,"orderId":4002}}]}],"type":"Command"}},{"source":{"_type":"Policy","displayName":"주문 생성 시 옵션 재고 차감","name":"OrderPlacementToStockDecrease","incomingRelations":[{"source":{"_type":"Event","displayName":"주문이 생성됨","name":"OrderPlaced","trigger":"","incomingRelations":[{"source":{"_type":"Command","controllerInfo":{"apiPath":"placeorder","fullApiPath":"","method":"POST"},"displayName":"주문 생성","isRestRepository":false,"name":"PlaceOrder","restRepositoryInfo":{"method":"POST"},"trigger":"@PrePersist","examples":[{"given":[{"name":"Order","type":"Aggregate","value":{"cartItemId":"N/A","createdAt":"2024-06-01T10:00:00Z","orderId":1001,"paymentStatus":"NOT_REQUESTED","status":"PLACED","updatedAt":"2024-06-01T10:00:00Z","userId":2001}}],"then":[{"name":"OrderPlaced","type":"Event","value":{"createdAt":"2024-06-01T10:01:00Z","items":[{"isFlatFooted":false,"price":99000,"productId":4001,"quantity":1,"size":"260","width":"D"}],"orderId":1002,"status":"PLACED","userId":2001}}],"when":[{"name":"PlaceOrder","type":"Command","value":{"cartItemIds":[{"cartItemId":3001}],"userId":2001}}]},{"given":[{"name":"Order","type":"Aggregate","value":{"cartItemId":"N/A","createdAt":"2024-06-01T10:00:00Z","orderId":1003,"paymentStatus":"NOT_REQUESTED","status":"PLACED","updatedAt":"2024-06-01T10:00:00Z","userId":2002}}],"then":[{"name":"OrderPlacementFailedDueToMissingOption","type":"Event","value":{"cartItemIds":[{"cartItemId":3002}],"errorMessage":"필수 옵션(사이즈 등)이 선택되지 않았습니다.","userId":2002}}],"when":[{"name":"PlaceOrder","type":"Command","value":{"cartItemIds":[{"cartItemId":3002}],"userId":2002}}]}],"type":"Command"}},{"source":{"_type":"Policy","displayName":"장바구니 상품 주문 생성 자동화","name":"CartItemToOrderPlacement","type":"Policy","incomingRelations":[{"source":{"_type":"Event","displayName":"장바구니에 상품이 추가됨","name":"CartItemAdded","trigger":"","incomingRelations":[{"source":{"_type":"Command","controllerInfo":{"apiPath":"addcartitem","fullApiPath":"","method":"POST"},"displayName":"장바구니에 상품 추가","isRestRepository":false,"name":"AddCartItem","restRepositoryInfo":{"method":"POST"},"trigger":"@PrePersist","examples":[{"given":[{"name":"CartItem","type":"Aggregate","value":{"cartItemId":1003,"createdAt":"2024-06-01T10:00:00Z","inventoryStockId":{"inventoryStockId":4003},"isFlatFooted":false,"productId":{"productId":3003},"quantity":0,"size":"255","status":"IN_CART","updatedAt":"2024-06-01T10:00:00Z","userId":2003,"width":"E"}}],"then":[{"name":"CartItemAdded","type":"Event","value":{"addedAt":"2024-06-01T10:10:00Z","cartItemId":1003,"inventoryStockId":{"inventoryStockId":4003},"isFlatFooted":false,"productId":{"productId":3003},"quantity":2,"size":"255","userId":2003,"width":"E"}}],"when":[{"name":"AddCartItem","type":"Command","value":{"inventoryStockId":{"inventoryStockId":4003},"isFlatFooted":false,"productId":{"productId":3003},"quantity":2,"size":"255","userId":2003,"width":"E"}}]},{"given":[{"name":"CartItem","type":"Aggregate","value":{"cartItemId":1004,"createdAt":"2024-06-01T10:00:00Z","inventoryStockId":{"inventoryStockId":4004},"isFlatFooted":true,"productId":{"productId":3004},"quantity":0,"size":"250","status":"IN_CART","updatedAt":"2024-06-01T10:00:00Z","userId":2004,"width":"D"}}],"then":[{"name":"OrderPlacementFailedDueToMissingOption","type":"Event","value":{"cartItemIds":[{"cartItemId":1004}],"errorMessage":"수량이 1개 이상이어야 합니다.","userId":2004}}],"when":[{"name":"AddCartItem","type":"Command","value":{"inventoryStockId":{"inventoryStockId":4004},"isFlatFooted":true,"productId":{"productId":3004},"quantity":0,"size":"250","userId":2004,"width":"D"}}]}],"type":"Command"}}],"type":"Event"}}]}}],"type":"Event"}}],"type":"Policy"}}],"type":"Event"}}],"type":"Policy"}}],"type":"Event"}}]},{"_type":"Policy","displayName":"재고 초기화 시 재고 정보 노출","name":"DisplayStockOnStockInitialization","incomingRelations":[{"source":{"_type":"Event","displayName":"상품 옵션 재고가 초기화됨","name":"ProductOptionStockInitialized","trigger":"","incomingRelations":[{"source":{"_type":"Command","controllerInfo":{"apiPath":"registerproductoption","fullApiPath":"","method":"POST"},"displayName":"상품 옵션 등록","isRestRepository":false,"name":"RegisterProductOption","restRepositoryInfo":{"method":"POST"},"trigger":"@PrePersist","examples":[{"given":[{"name":"Product","type":"Aggregate","value":{"createdAt":"2024-03-01T09:00:00Z","description":"편안한 남성용 스니커즈","name":"스니커즈","optionRequiredType":"REQUIRED","productId":1001,"status":"ON_SALE","updatedAt":"2024-03-01T09:00:00Z"}}],"then":[{"name":"ProductOptionRegistered","type":"Event","value":{"isFlatFooted":false,"productId":1001,"productOptionId":2001,"size":"270","width":"D"}}],"when":[{"name":"RegisterProductOption","type":"Command","value":{"isFlatFooted":false,"productId":1001,"size":"270","width":"D"}}]},{"given":[{"name":"Product","type":"Aggregate","value":{"createdAt":"2024-03-01T09:00:00Z","description":"편안한 남성용 스니커즈","name":"스니커즈","optionRequiredType":"REQUIRED","productId":1001,"status":"ON_SALE","updatedAt":"2024-03-01T09:00:00Z"}}],"then":[{"name":"ProductOptionStockInitialized","type":"Event","value":{"initialStockQuantity":50,"productId":1001,"productOptionId":2001}}],"when":[{"name":"RegisterProductOption","type":"Command","value":{"isFlatFooted":false,"productId":1001,"size":"270","width":"D"}}]},{"given":[{"name":"Product","type":"Aggregate","value":{"createdAt":"2024-03-01T09:00:00Z","description":"편안한 남성용 스니커즈","name":"스니커즈","optionRequiredType":"REQUIRED","productId":1001,"status":"ON_SALE","updatedAt":"2024-03-01T09:00:00Z"}}],"then":[{"name":"ProductOptionDisplayed","type":"Event","value":{"isFlatFooted":false,"productId":1001,"productOptionId":2001,"size":"270","width":"D"}}],"when":[{"name":"RegisterProductOption","type":"Command","value":{"isFlatFooted":false,"productId":1001,"size":"270","width":"D"}}]},{"given":[{"name":"Product","type":"Aggregate","value":{"createdAt":"2024-03-01T09:00:00Z","description":"편안한 남성용 스니커즈","name":"스니커즈","optionRequiredType":"REQUIRED","productId":1001,"status":"ON_SALE","updatedAt":"2024-03-01T09:00:00Z"}}],"then":[{"name":"ProductOptionRegistered","type":"Event","value":{"isFlatFooted":false,"productId":1001,"width":"D"}}],"when":[{"name":"RegisterProductOption","type":"Command","value":{"isFlatFooted":false,"productId":1001,"width":"D"}}]}],"type":"Command"}},{"source":{"_type":"Command","controllerInfo":{"apiPath":"initializeproductoptionstock","fullApiPath":"","method":"POST"},"displayName":"상품 옵션 재고 초기화","isRestRepository":false,"name":"InitializeProductOptionStock","restRepositoryInfo":{"method":"POST"},"trigger":"@PrePersist","examples":[{"given":[{"name":"InventoryStock","type":"Aggregate","value":{"createdAt":"N/A","inventoryStockId":1001,"isFlatFooted":false,"productId":2001,"productOptionId":{"productOptionId":3001},"size":"260","status":"IN_STOCK","stockQuantity":0,"updatedAt":"N/A","width":"Wide"}}],"then":[{"name":"ProductOptionStockInitialized","type":"Event","value":{"initialStockQuantity":20,"productId":2001,"productOptionId":3001}}],"when":[{"name":"InitializeProductOptionStock","type":"Command","value":{"initialStockQuantity":20,"inventoryStockId":1001,"isFlatFooted":false,"productId":2001,"productOptionId":{"productOptionId":3001},"size":"260","width":"Wide"}}]}],"type":"Command"}}],"type":"Event"}}],"type":"Policy"},{"_type":"Policy","displayName":"재고 소진 시 품절 처리","name":"MarkOptionSoldOutOnStockDepletion","incomingRelations":[{"source":{"_type":"Event","displayName":"옵션별 재고가 차감됨","name":"OptionStockDecreased","trigger":"","incomingRelations":[{"source":{"_type":"Command","controllerInfo":{"apiPath":"decreaseoptionstock","fullApiPath":"","method":"POST"},"displayName":"옵션별 재고 차감","isRestRepository":false,"name":"DecreaseOptionStock","restRepositoryInfo":{"method":"POST"},"trigger":"@PrePersist","examples":[{"given":[{"name":"InventoryStock","type":"Aggregate","value":{"createdAt":"N/A","inventoryStockId":1004,"isFlatFooted":false,"productId":2004,"productOptionId":{"productOptionId":3004},"size":"255","status":"IN_STOCK","stockQuantity":5,"updatedAt":"N/A","width":"Normal"}}],"then":[{"name":"OptionStockDecreased","type":"Event","value":{"decreasedAt":"2024-06-01T10:01:00Z","decreasedQuantity":2,"inventoryStockId":1004,"orderId":4001,"productId":2004,"productOptionId":3004,"stockQuantity":3}}],"when":[{"name":"DecreaseOptionStock","type":"Command","value":{"decreasedQuantity":2,"inventoryStockId":1004,"orderId":4001}}]},{"given":[{"name":"InventoryStock","type":"Aggregate","value":{"createdAt":"N/A","inventoryStockId":1005,"isFlatFooted":true,"productId":2005,"productOptionId":{"productOptionId":3005},"size":"250","status":"IN_STOCK","stockQuantity":1,"updatedAt":"N/A","width":"Wide"}}],"then":[{"name":"OptionStockDecreased","type":"Event","value":{"decreasedAt":"2024-06-01T10:02:00Z","decreasedQuantity":1,"inventoryStockId":1005,"orderId":4002,"productId":2005,"productOptionId":3005,"stockQuantity":0}}],"when":[{"name":"DecreaseOptionStock","type":"Command","value":{"decreasedQuantity":1,"inventoryStockId":1005,"orderId":4002}}]}],"type":"Command"}},{"source":{"_type":"Policy","displayName":"주문 생성 시 옵션 재고 차감","name":"OrderPlacementToStockDecrease","incomingRelations":[{"source":{"_type":"Event","displayName":"주문이 생성됨","name":"OrderPlaced","trigger":"","incomingRelations":[{"source":{"_type":"Command","controllerInfo":{"apiPath":"placeorder","fullApiPath":"","method":"POST"},"displayName":"주문 생성","isRestRepository":false,"name":"PlaceOrder","restRepositoryInfo":{"method":"POST"},"trigger":"@PrePersist","examples":[{"given":[{"name":"Order","type":"Aggregate","value":{"cartItemId":"N/A","createdAt":"2024-06-01T10:00:00Z","orderId":1001,"paymentStatus":"NOT_REQUESTED","status":"PLACED","updatedAt":"2024-06-01T10:00:00Z","userId":2001}}],"then":[{"name":"OrderPlaced","type":"Event","value":{"createdAt":"2024-06-01T10:01:00Z","items":[{"isFlatFooted":false,"price":99000,"productId":4001,"quantity":1,"size":"260","width":"D"}],"orderId":1002,"status":"PLACED","userId":2001}}],"when":[{"name":"PlaceOrder","type":"Command","value":{"cartItemIds":[{"cartItemId":3001}],"userId":2001}}]},{"given":[{"name":"Order","type":"Aggregate","value":{"cartItemId":"N/A","createdAt":"2024-06-01T10:00:00Z","orderId":1003,"paymentStatus":"NOT_REQUESTED","status":"PLACED","updatedAt":"2024-06-01T10:00:00Z","userId":2002}}],"then":[{"name":"OrderPlacementFailedDueToMissingOption","type":"Event","value":{"cartItemIds":[{"cartItemId":3002}],"errorMessage":"필수 옵션(사이즈 등)이 선택되지 않았습니다.","userId":2002}}],"when":[{"name":"PlaceOrder","type":"Command","value":{"cartItemIds":[{"cartItemId":3002}],"userId":2002}}]}],"type":"Command"}},{"source":{"_type":"Policy","displayName":"장바구니 상품 주문 생성 자동화","name":"CartItemToOrderPlacement","type":"Policy","incomingRelations":[{"source":{"_type":"Event","displayName":"장바구니에 상품이 추가됨","name":"CartItemAdded","trigger":"","incomingRelations":[{"source":{"_type":"Command","controllerInfo":{"apiPath":"addcartitem","fullApiPath":"","method":"POST"},"displayName":"장바구니에 상품 추가","isRestRepository":false,"name":"AddCartItem","restRepositoryInfo":{"method":"POST"},"trigger":"@PrePersist","examples":[{"given":[{"name":"CartItem","type":"Aggregate","value":{"cartItemId":1003,"createdAt":"2024-06-01T10:00:00Z","inventoryStockId":{"inventoryStockId":4003},"isFlatFooted":false,"productId":{"productId":3003},"quantity":0,"size":"255","status":"IN_CART","updatedAt":"2024-06-01T10:00:00Z","userId":2003,"width":"E"}}],"then":[{"name":"CartItemAdded","type":"Event","value":{"addedAt":"2024-06-01T10:10:00Z","cartItemId":1003,"inventoryStockId":{"inventoryStockId":4003},"isFlatFooted":false,"productId":{"productId":3003},"quantity":2,"size":"255","userId":2003,"width":"E"}}],"when":[{"name":"AddCartItem","type":"Command","value":{"inventoryStockId":{"inventoryStockId":4003},"isFlatFooted":false,"productId":{"productId":3003},"quantity":2,"size":"255","userId":2003,"width":"E"}}]},{"given":[{"name":"CartItem","type":"Aggregate","value":{"cartItemId":1004,"createdAt":"2024-06-01T10:00:00Z","inventoryStockId":{"inventoryStockId":4004},"isFlatFooted":true,"productId":{"productId":3004},"quantity":0,"size":"250","status":"IN_CART","updatedAt":"2024-06-01T10:00:00Z","userId":2004,"width":"D"}}],"then":[{"name":"OrderPlacementFailedDueToMissingOption","type":"Event","value":{"cartItemIds":[{"cartItemId":1004}],"errorMessage":"수량이 1개 이상이어야 합니다.","userId":2004}}],"when":[{"name":"AddCartItem","type":"Command","value":{"inventoryStockId":{"inventoryStockId":4004},"isFlatFooted":true,"productId":{"productId":3004},"quantity":0,"size":"250","userId":2004,"width":"D"}}]}],"type":"Command"}}],"type":"Event"}}]}}],"type":"Event"}}],"type":"Policy"}}],"type":"Event"}}],"type":"Policy"}],"readModels":[{"_type":"View","displayName":"상품 옵션 목록 조회","fieldDescriptors":[{"_type":"FieldDescriptor","className":"Long","name":"id"}],"name":"ProductOptionList","queryOption":{"apiPath":""},"queryParameters":[{"_type":"FieldDescriptor","className":"Long","displayName":"","name":"productId"}]},{"_type":"View","displayName":"상품 옵션 상세 조회","fieldDescriptors":[{"_type":"FieldDescriptor","className":"Long","name":"id"}],"name":"ProductOptionDetail","queryOption":{"apiPath":""},"queryParameters":[{"_type":"FieldDescriptor","className":"Long","displayName":"","name":"productId"},{"_type":"FieldDescriptor","className":"Long","displayName":"","name":"productOptionId"}]},{"_type":"View","displayName":"옵션별 재고 현황 조회","fieldDescriptors":[{"_type":"FieldDescriptor","className":"Long","name":"id"}],"name":"InventoryStockStatus","queryOption":{"apiPath":""},"queryParameters":[{"_type":"FieldDescriptor","className":"Long","displayName":"","name":"productId"},{"_type":"FieldDescriptor","className":"ProductOptionId","displayName":"","name":"productOptionId"},{"_type":"FieldDescriptor","className":"String","displayName":"","name":"size"},{"_type":"FieldDescriptor","className":"String","displayName":"","name":"width"},{"_type":"FieldDescriptor","className":"Boolean","displayName":"","name":"isFlatFooted"},{"_type":"FieldDescriptor","className":"StockStatus","displayName":"","name":"soldOutStatus"},{"_type":"FieldDescriptor","className":"Integer","displayName":"","name":"page"},{"_type":"FieldDescriptor","className":"Integer","displayName":"","name":"size"}]}]}
